<!DOCTYPE html> <html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> <title>论文笔记｜【论文笔记合集】TimesNet之TimesBlock详解 &mdash; Slience_me的博客</title> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/primer-css/css/primer.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/collection.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/repo-card.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/sections/repo-list.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/boxed-group.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/common.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/responsive.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/posts/index.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/octicons/octicons/octicons.css"> <link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/share.js/dist/css/share.min.css"> <link rel="canonical" href="https://blog.slienceme.cn/2024/01/19/TimesNet%E4%B9%8BTimesBlock%E8%AF%A6%E8%A7%A3/"> <link rel="alternate" type="application/atom+xml" title="Slience_me的博客" href="https://blog.slienceme.cn/feed.xml"> <link rel="shortcut icon" href="https://blog.slienceme.cn/favicon.ico"> <meta property="og:title" content="论文笔记｜【论文笔记合集】TimesNet之TimesBlock详解"> <meta name="keywords" content="机器学习, 论文笔记"> <meta name="og:keywords" content="机器学习, 论文笔记"> <meta name="description" content=""> <meta name="og:description" content=""> <meta property="og:url" content="https://blog.slienceme.cn/2024/01/19/TimesNet%E4%B9%8BTimesBlock%E8%AF%A6%E8%A7%A3/"> <meta property="og:site_name" content="Slience_me的博客"> <meta property="og:type" content="article"> <meta property="og:locale" content="zh_CN" /> <meta property="article:published_time" content="2024-01-19"> <meta name="google-site-verification" content="2feHjT1GNs1Yi2JQfOtdYx7d048naG_-cMwZaDAopIA" /> <script src="https://blog.slienceme.cn/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/main.js"></script> </head> <body class="" data-mz=""> <header class="site-header"> <div class="container"> <h1><a href="https://blog.slienceme.cn/" title="Slience_me的博客"><span class="octicon octicon-mark-github"></span> Slience_me的博客</a></h1> <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <nav class="site-header-nav" role="navigation"> <a href="https://blog.slienceme.cn/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://blog.slienceme.cn/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://blog.slienceme.cn/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://blog.slienceme.cn/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://blog.slienceme.cn/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://blog.slienceme.cn/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://blog.slienceme.cn/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://blog.slienceme.cn/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://blog.slienceme.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a> </nav> </div> </header> <section class="collection-head small geopattern" data-pattern-id="论文笔记｜【论文笔记合集】Ti"> <div class="container"> <div class="columns"> <div class="column three-fourths"> <div class="collection-title"> <h1 class="collection-header">论文笔记｜【论文笔记合集】TimesNet之TimesBlock详解</h1> <div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2024/01/19 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://blog.slienceme.cn/categories/#论文笔记" title="论文笔记">论文笔记</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 10691 字，约 31 分钟 </span> </div> </div> </div> <div class="column one-fourth mobile-hidden"> <div class="collection-title"> </div> </div> </div> </div> </section> <section class="container content"> <div class="columns"> <div class="column three-fourths" > <article class="article-content markdown-body"> <p><img src="https://blog.slienceme.cn/images/posts/logo_slienceme3.png" alt="img" /></p> <p>本文作者： <a href="https://slienceme.cn/">slience_me</a></p> <hr /> <h1 id="timesnet之timesblock详解">TimesNet之TimesBlock详解</h1> <p><img src="https://raw.githubusercontent.com/slience-me/picGo/master/images/image-20240119171017338.png" alt="image-20240119171017338" /></p> <h2 id="1-源代码">1. 源代码</h2> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">TimesBlock</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TimesBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">=</span> <span class="n">configs</span><span class="p">.</span><span class="n">seq_len</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span> <span class="o">=</span> <span class="n">configs</span><span class="p">.</span><span class="n">pred_len</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">configs</span><span class="p">.</span><span class="n">top_k</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span>
            <span class="n">Inception_Block_V1</span><span class="p">(</span><span class="n">configs</span><span class="p">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="p">.</span><span class="n">d_ff</span><span class="p">,</span>
                               <span class="n">num_kernels</span><span class="o">=</span><span class="n">configs</span><span class="p">.</span><span class="n">num_kernels</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="n">GELU</span><span class="p">(),</span>
            <span class="n">Inception_Block_V1</span><span class="p">(</span><span class="n">configs</span><span class="p">.</span><span class="n">d_ff</span><span class="p">,</span> <span class="n">configs</span><span class="p">.</span><span class="n">d_model</span><span class="p">,</span>
                               <span class="n">num_kernels</span><span class="o">=</span><span class="n">configs</span><span class="p">.</span><span class="n">num_kernels</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>
        <span class="n">period_list</span><span class="p">,</span> <span class="n">period_weight</span> <span class="o">=</span> <span class="n">FFT_for_Period</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">):</span>
            <span class="n">period</span> <span class="o">=</span> <span class="n">period_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">%</span> <span class="n">period</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">//</span> <span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span>
                <span class="n">padding</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)),</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]).</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">padding</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span>
                <span class="n">out</span> <span class="o">=</span> <span class="n">x</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">length</span> <span class="o">//</span> <span class="n">period</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">N</span><span class="p">).</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">contiguous</span><span class="p">()</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
            <span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[:,</span> <span class="p">:(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">),</span> <span class="p">:])</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">stack</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">period_weight</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">period_weight</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">period_weight</span> <span class="o">=</span> <span class="n">period_weight</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">res</span> <span class="o">*</span> <span class="n">period_weight</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">x</span>
        <span class="k">return</span> <span class="n">res</span>
</code></pre></div></div> <h2 id="2-分步详解">2. 分步详解</h2> <h3 id="21-init部分代码">2.1 init部分代码</h3> <blockquote> <ul> <li> <p><strong>seq_lem</strong>：序列长度</p> </li> <li> <p><strong>pred_len</strong>：预测长度</p> </li> <li> <p><strong>tok_k</strong>：最高的k个</p> </li> </ul> <hr /> <ul> <li><strong>d_model</strong>：模型的维数</li> <li><strong>d_ff</strong>：全连接层的维度</li> <li><strong>num_kernels</strong>：卷积核的数量</li> </ul> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">(</span><span class="n">TimesBlock</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">=</span> <span class="n">configs</span><span class="p">.</span><span class="n">seq_len</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span> <span class="o">=</span> <span class="n">configs</span><span class="p">.</span><span class="n">pred_len</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">configs</span><span class="p">.</span><span class="n">top_k</span>
    <span class="bp">self</span><span class="p">.</span><span class="n">conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">Sequential</span><span class="p">(</span>
        <span class="n">Inception_Block_V1</span><span class="p">(</span><span class="n">configs</span><span class="p">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">configs</span><span class="p">.</span><span class="n">d_ff</span><span class="p">,</span> <span class="n">num_kernels</span><span class="o">=</span><span class="n">configs</span><span class="p">.</span><span class="n">num_kernels</span><span class="p">),</span>
        <span class="n">nn</span><span class="p">.</span><span class="n">GELU</span><span class="p">(),</span>
        <span class="n">Inception_Block_V1</span><span class="p">(</span><span class="n">configs</span><span class="p">.</span><span class="n">d_ff</span><span class="p">,</span> <span class="n">configs</span><span class="p">.</span><span class="n">d_model</span><span class="p">,</span> <span class="n">num_kernels</span><span class="o">=</span><span class="n">configs</span><span class="p">.</span><span class="n">num_kernels</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">class</span> <span class="nc">Inception_Block_V1</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">num_kernels</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">init_weight</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Inception_Block_V1</span><span class="p">,</span> <span class="bp">self</span><span class="p">).</span><span class="n">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">in_channels</span> <span class="o">=</span> <span class="n">in_channels</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">out_channels</span> <span class="o">=</span> <span class="n">out_channels</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">num_kernels</span> <span class="o">=</span> <span class="n">num_kernels</span>
        <span class="n">kernels</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num_kernels</span><span class="p">):</span>
            <span class="n">kernels</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Conv2d</span><span class="p">(</span><span class="n">in_channels</span><span class="p">,</span> <span class="n">out_channels</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="n">i</span><span class="p">))</span>
        <span class="bp">self</span><span class="p">.</span><span class="n">kernels</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">kernels</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">init_weight</span><span class="p">:</span>
            <span class="bp">self</span><span class="p">.</span><span class="n">_initialize_weights</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_initialize_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">.</span><span class="n">modules</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">nn</span><span class="p">.</span><span class="n">Conv2d</span><span class="p">):</span>
                <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">kaiming_normal_</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">weight</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s">'fan_out'</span><span class="p">,</span> <span class="n">nonlinearity</span><span class="o">=</span><span class="s">'relu'</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">m</span><span class="p">.</span><span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">nn</span><span class="p">.</span><span class="n">init</span><span class="p">.</span><span class="n">constant_</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">bias</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
        <span class="n">res_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">num_kernels</span><span class="p">):</span>
            <span class="n">res_list</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">kernels</span><span class="p">[</span><span class="n">i</span><span class="p">](</span><span class="n">x</span><span class="p">))</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">stack</span><span class="p">(</span><span class="n">res_list</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">).</span><span class="n">mean</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>
</code></pre></div></div> <p><strong>GELU()函数</strong></p> <p><img src="https://raw.githubusercontent.com/slience-me/picGo/master/images/image-20240119181212904.png" alt="image-20240119181212904" /></p> <blockquote> <p>GELU（Gaussian Error Linear Unit）是一种激活函数，它在神经网络中用于引入非线性性。GELU 的特点包括以下几个方面：</p> <ol> <li> <p><strong>光滑性：</strong> GELU 是一种光滑的激活函数，它的导数在整个实数域内都是定义良好的。这对于反向传播算法的有效性和数值稳定性是有益的。</p> </li> <li> <p><strong>非饱和性：</strong> GELU 在整个实数域内都不饱和。这意味着在输入信号的范围内，梯度不会消失，避免了一些激活函数（如 sigmoid、tanh）中可能出现的梯度消失问题。</p> </li> <li> <p><strong>逼近性质：</strong> GELU 在大部分实数域内近似于线性函数，这使得它在模型中可以起到近似线性的作用。在输入较大或较小的情况下，GELU 可能不太线性，但在输入接近零时，它趋向于线性变换。</p> </li> <li> <p><strong>归一化性质：</strong> GELU 的形式中包含了高斯分布的累积分布函数（CDF），这使得 GELU 对输入信号的归一化具有一定的性质。这有助于训练深度神经网络时的稳定性。</p> </li> <li> <p><strong>引入噪声：</strong> GELU 的形式与高斯分布相关，因此在一定程度上可以被视为引入了一些噪声。这种噪声引入可以有助于模型的鲁棒性，对抗一些过拟合问题。</p> </li> </ol> <p>GELU 出现在一些深度学习模型中，特别是在一些 Transformer 模型中，作为激活函数的选择。其性质使得它在一些情况下表现得很好，但在实践中，选择激活函数通常还取决于具体任务和经验。</p> </blockquote> <blockquote> <p><strong>GELU的优点</strong> <a href="https://zhuanlan.zhihu.com/p/302394523">参考链接</a></p> <p>GELU的优点是，它在处理负数时不会像ReLU一样将输入裁剪到0，这可能导致梯度消失的问题。</p> <ul> <li> <p>具有更光滑的导数：</p> </li> <li> <ul> <li>GELU函数的导数是连续的，这使得在训练深度神经网络时可以更容易地传播梯度，避免了ReLU函数在 处的导数不连续的问题，从而减少了训练过程中出现的梯度消失问题</li> </ul> </li> <li> <p>可以加速收敛：</p> </li> <li> <ul> <li>GELU函数在激活函数的非线性变换中引入了类似于sigmoid函数的变换，这使得GELU函数的输出可以落在一个更广的范围内，有助于加速模型的收敛速度。</li> </ul> </li> </ul> </blockquote> <h3 id="22-forward部分代码">2.2 forward部分代码</h3> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
    <span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">()</span>
    <span class="n">period_list</span><span class="p">,</span> <span class="n">period_weight</span> <span class="o">=</span> <span class="n">FFT_for_Period</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">):</span>
        <span class="n">period</span> <span class="o">=</span> <span class="n">period_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">%</span> <span class="n">period</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">//</span> <span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span>
            <span class="n">padding</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)),</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]).</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">padding</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="n">x</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">length</span> <span class="o">//</span> <span class="n">period</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">N</span><span class="p">).</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">contiguous</span><span class="p">()</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
        <span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[:,</span> <span class="p">:(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">),</span> <span class="p">:])</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">stack</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">period_weight</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">period_weight</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">period_weight</span> <span class="o">=</span> <span class="n">period_weight</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">res</span> <span class="o">*</span> <span class="n">period_weight</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">res</span>
</code></pre></div></div> <hr /> <blockquote> <ul> <li>B: Batch size 批大小</li> <li>T: Time steps or sequence length 时间序列长度</li> <li>N: Number of channels or features 通道特征数量</li> </ul> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">B</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span> <span class="o">=</span> <span class="n">x</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="c1"># 获取三个值的大小
</span><span class="n">period_list</span><span class="p">,</span> <span class="n">period_weight</span> <span class="o">=</span> <span class="n">FFT_for_Period</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">)</span> <span class="c1"># 函数调用
</span></code></pre></div></div> <ul> <li><strong>period_list</strong>：信号中每个最大频率成分的周期长度list</li> <li><strong>period_weight</strong>：相应频率成分的平均振幅信息</li> </ul> <hr /> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">k</span><span class="p">):</span>
    <span class="c1"># 获取第i个频率对应的周期长度
</span>    <span class="n">period</span> <span class="o">=</span> <span class="n">period_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
    <span class="c1"># 如果总的序列长度（self.seq_len + self.pred_len）不能被实际周期整除，说明需要进行填充
</span>    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">%</span> <span class="n">period</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># 计算调整后的序列长度，使其能够整除周期长度
</span>        <span class="c1"># 默认label_len=48，pred_len=96，48+96=144
</span>        <span class="n">length</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">//</span> <span class="n">period</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">period</span>
        <span class="c1"># 创建一个零张量，用于进行填充，保持与输入序列相同的批量大小和特征数
</span>        <span class="c1"># 创建一个0填充张量，形状为 [B, 填充长度, N]
</span>        <span class="n">padding</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="n">length</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)),</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]).</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
        <span class="c1"># 将输入序列 x 与填充的零张量拼接在时间步维度上，以得到填充后的新序列。
</span>        <span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">padding</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">length</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">length</span> <span class="o">//</span> <span class="n">period</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">N</span><span class="p">).</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">contiguous</span><span class="p">()</span>
    <span class="c1"># 2D conv: from 1d Variation to 2d Variation
</span>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="p">.</span><span class="n">conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
    <span class="c1"># reshape back
</span>    <span class="c1"># [B, period, N, length // period]
</span>    <span class="c1"># 使用 reshape 操作将张量的形状调整为 [B, -1(自动计算的维度，以确保总的元素数量不变), N]
</span>    <span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
    <span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[:,</span> <span class="p">:(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">),</span> <span class="p">:])</span>
</code></pre></div></div> <blockquote> <p>««« 问题：»»»</p> </blockquote> <ul> <li><strong>在1D变2D时，涉及到了 length = (((self.seq_len + self.pred_len) // period) + 1) * period，我不是很明白这边为什么要把self.pred_len也加入进去？</strong><a href="https://github.com/thuml/Time-Series-Library/issues/7">来源</a></li> </ul> <blockquote> <p>对于预测任务来说，TimesNet的pipeline是：在embedding之后先将序列长度扩充为self.seq_len + self.pred_len，然后再不断refine预测结果。所以在中间层的TimesBlock其实在处理预测的中间结果（其长度为self.seq_len + self.pred_len）。但是对于其他任务，self.pred_len=0，所以加和不加self.pred_len没有影响。</p> </blockquote> <ul> <li>««« <strong>填充的过程解析</strong>»»»</li> </ul> <blockquote> <p>假设 <code class="language-plaintext highlighter-rouge">self.seq_len</code> 是 100，<code class="language-plaintext highlighter-rouge">self.pred_len</code> 是 20，<code class="language-plaintext highlighter-rouge">period_list</code> 是一个包含两个实际周期的列表 <code class="language-plaintext highlighter-rouge">[25, 30]</code>，而 <code class="language-plaintext highlighter-rouge">self.k</code> 是 2。</p> <p>首先，对于第一个实际周期（25），计算填充后的新序列长度：</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length</span> <span class="o">=</span> <span class="p">(((</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)</span> <span class="o">//</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>
</code></pre></div> </div> <p>将具体数值代入计算：</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">length</span> <span class="o">=</span> <span class="p">(((</span><span class="mi">100</span> <span class="o">+</span> <span class="mi">20</span><span class="p">)</span> <span class="o">//</span> <span class="mi">25</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>
       <span class="o">=</span> <span class="p">(</span><span class="mi">120</span> <span class="o">//</span> <span class="mi">25</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>
       <span class="o">=</span> <span class="p">(</span><span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">25</span>
       <span class="o">=</span> <span class="mi">5</span> <span class="o">*</span> <span class="mi">25</span>
       <span class="o">=</span> <span class="mi">125</span>
</code></pre></div> </div> <p>因此，对于第一个实际周期，填充后的新序列长度是 125。然后，根据这个长度创建一个零张量 <code class="language-plaintext highlighter-rouge">padding</code>：</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">padding</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="mi">125</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">)),</span> <span class="n">x</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]).</span><span class="n">to</span><span class="p">(</span><span class="n">x</span><span class="p">.</span><span class="n">device</span><span class="p">)</span>
</code></pre></div> </div> <p>接下来，将输入序列 <code class="language-plaintext highlighter-rouge">x</code> 与填充的零张量拼接在时间步维度上：</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">padding</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div> </div> <p>对于第二个实际周期（30），同样进行类似的计算和操作。最终，<code class="language-plaintext highlighter-rouge">out</code> 将是根据实际周期填充或未填充的新序列。</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="n">length</span> <span class="o">//</span> <span class="n">period</span><span class="p">,</span> <span class="n">period</span><span class="p">,</span> <span class="n">N</span><span class="p">).</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="n">contiguous</span><span class="p">()</span>
</code></pre></div></div> <blockquote> <p>这行代码对 <code class="language-plaintext highlighter-rouge">out</code> 进行了形状调整（reshaping）和维度交换（permutation），并最终得到一个新的张量。让我们逐步解释：</p> <ol> <li> <p><code class="language-plaintext highlighter-rouge">out.reshape(B, length // period, period, N)</code>: 这一步通过 <code class="language-plaintext highlighter-rouge">reshape</code> 操作将 <code class="language-plaintext highlighter-rouge">out</code> 的形状调整为四维张量。具体来说，新的形状是 <code class="language-plaintext highlighter-rouge">[B, length // period, period, N]</code>。这里的含义是：</p> <ul> <li><code class="language-plaintext highlighter-rouge">B</code>: 批量大小，保持不变。</li> <li><code class="language-plaintext highlighter-rouge">length // period</code>: 新的时间步数，表示实际周期的倍数。</li> <li><code class="language-plaintext highlighter-rouge">period</code>: 实际周期，表示每个周期内的时间步数。</li> <li><code class="language-plaintext highlighter-rouge">N</code>: 特征数，保持不变。</li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">.permute(0, 3, 1, 2)</code>: 这一步使用 <code class="language-plaintext highlighter-rouge">permute</code> 操作交换张量的维度。具体来说，它将原始张量的维度重新排列为 <code class="language-plaintext highlighter-rouge">[B, N, length // period, period]</code>。这里的含义是：</p> <ul> <li>第一个维度保持为批量大小 <code class="language-plaintext highlighter-rouge">B</code>。</li> <li>第二个维度变为特征数 <code class="language-plaintext highlighter-rouge">N</code>。</li> <li>第三个维度变为新的时间步数 <code class="language-plaintext highlighter-rouge">length // period</code>。</li> <li>第四个维度变为实际周期 <code class="language-plaintext highlighter-rouge">period</code>。</li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">.contiguous()</code>: 这一步确保张量的内存是连续的，有时在进行形状调整后可能会导致不连续的内存布局。</p> </li> </ol> <p>最终，通过这些操作，<code class="language-plaintext highlighter-rouge">out</code> 被调整为一个四维张量，表示批量中每个样本的时间序列，其中时间步按照实际周期分组，每个组内有 <code class="language-plaintext highlighter-rouge">period</code> 个时间步。这种形状的张量可能是为了后续的处理或模型输入的需要。</p> <p>self.seq_len + self.pred_len = 48 + 96 = 144</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>length = (((self.seq_len + self.pred_len) // period) + 1) * period
</code></pre></div> </div> <p>out before shape： [B, period, N]</p> <p>out after shape：[B, N, length//period, period]</p> </blockquote> <ul> <li>«««<strong>Inception_Block_V1的输入要求？</strong>»»»</li> </ul> <blockquote> <p>这 <code class="language-plaintext highlighter-rouge">Inception_Block_V1</code> 模块的输入形状应该是一个四维的张量，即 <code class="language-plaintext highlighter-rouge">(batch_size, in_channels, height, width)</code>。让我们详细解释：</p> <ol> <li><strong>输入张量 <code class="language-plaintext highlighter-rouge">x</code> 的形状：</strong> <ul> <li><code class="language-plaintext highlighter-rouge">batch_size</code>: 表示批量中样本的数量。</li> <li><code class="language-plaintext highlighter-rouge">in_channels</code>: 表示输入特征图的通道数。</li> <li><code class="language-plaintext highlighter-rouge">height</code>: 表示输入特征图的高度。</li> <li><code class="language-plaintext highlighter-rouge">width</code>: 表示输入特征图的宽度。</li> </ul> </li> <li><strong>模块内部操作：</strong> <ul> <li>对于每个卷积核，它接收输入张量 <code class="language-plaintext highlighter-rouge">x</code>，其中卷积核的大小是 <code class="language-plaintext highlighter-rouge">2 * i + 1</code>，<code class="language-plaintext highlighter-rouge">padding</code> 为 <code class="language-plaintext highlighter-rouge">i</code>。这样设计的目的是使用不同大小的卷积核来捕获输入中的不同尺度的特征。</li> <li>每个卷积核的输出形状是 <code class="language-plaintext highlighter-rouge">(batch_size, out_channels, height, width)</code>。</li> </ul> </li> <li><strong><code class="language-plaintext highlighter-rouge">nn.ModuleList</code> 和权重初始化：</strong> <ul> <li>使用 <code class="language-plaintext highlighter-rouge">nn.ModuleList</code> 存储多个卷积核。</li> <li>在 <code class="language-plaintext highlighter-rouge">_initialize_weights</code> 方法中对每个卷积层的权重进行初始化。这里使用了 Kaiming 初始化。</li> </ul> </li> <li><strong>前向传播 (<code class="language-plaintext highlighter-rouge">forward</code> 方法)：</strong> <ul> <li>对于每个卷积核，通过 <code class="language-plaintext highlighter-rouge">self.kernels[i](x)</code> 计算输出。</li> <li>将所有卷积核的输出堆叠在一起，形成一个张量，其形状为 <code class="language-plaintext highlighter-rouge">(batch_size, out_channels, height, width, num_kernels)</code>。</li> <li>沿着最后一个维度对这些卷积核的输出进行平均池化，得到最终的输出 <code class="language-plaintext highlighter-rouge">res</code>，其形状为 <code class="language-plaintext highlighter-rouge">(batch_size, out_channels, height, width)</code>。</li> </ul> </li> </ol> <p>因此，<code class="language-plaintext highlighter-rouge">Inception_Block_V1</code> 模块接受一个四维的输入张量，对每个卷积核计算输出，然后将这些输出进行平均池化，最终产生一个具有相同通道数和空间尺寸的输出张量。</p> <p>out before shape： [B, N, length//period, period]</p> <p>out after shape： [B, N, length//period, period]</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">out</span> <span class="o">=</span> <span class="n">out</span><span class="p">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="n">reshape</span><span class="p">(</span><span class="n">B</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
</code></pre></div></div> <blockquote> <p>这行代码对 <code class="language-plaintext highlighter-rouge">out</code> 进行了进一步的形状调整。让我们逐步解释：</p> <ol> <li><code class="language-plaintext highlighter-rouge">out.permute(0, 2, 3, 1)</code>: 使用 <code class="language-plaintext highlighter-rouge">permute</code> 操作重新排列张量的维度。具体来说，将 <code class="language-plaintext highlighter-rouge">out</code> 的维度重新排列为 <code class="language-plaintext highlighter-rouge">[B, period, N, length // period]</code>。这里的含义是： <ul> <li>第一个维度保持为批量大小 <code class="language-plaintext highlighter-rouge">B</code>。</li> <li>第二个维度变为实际周期 <code class="language-plaintext highlighter-rouge">period</code>。</li> <li>第三个维度变为特征数 <code class="language-plaintext highlighter-rouge">N</code>。</li> <li>第四个维度变为新的时间步数 <code class="language-plaintext highlighter-rouge">length // period</code>。</li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">.reshape(B, -1, N)</code>: 使用 <code class="language-plaintext highlighter-rouge">reshape</code> 操作将张量的形状调整为 <code class="language-plaintext highlighter-rouge">[B, -1, N]</code>。这里 <code class="language-plaintext highlighter-rouge">-1</code> 表示自动计算该维度的大小，以保持总的元素数量不变。因此，最终形状是：</p> <ul> <li><code class="language-plaintext highlighter-rouge">B</code>: 批量大小，保持不变。</li> <li><code class="language-plaintext highlighter-rouge">-1</code>: 自动计算的维度，以确保总的元素数量不变。</li> <li><code class="language-plaintext highlighter-rouge">N</code>: 特征数，保持不变。</li> </ul> </li> </ol> <p>通过这些操作，<code class="language-plaintext highlighter-rouge">out</code> 被调整为一个三维张量，表示批量中每个样本的时间序列，其中每个时间步对应于实际周期的一个子序列。这种形状可能是为了更方便地传递给模型的下一步处理。</p> <p>out before shape： [B, N, length//period, period]</p> <p>out after shape： [B, period, N]</p> </blockquote> <p>针对上述操作，一个shape样例：</p> <blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">period_list</span><span class="p">:</span> <span class="p">[</span><span class="mi">1751</span>  <span class="mi">583</span>  <span class="mi">437</span><span class="p">],</span> <span class="n">period_list</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="p">(</span><span class="mi">3</span><span class="p">,)</span>
<span class="n">period_weight</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">period</span><span class="p">:</span> <span class="mi">1751</span>
<span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1751</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
<span class="n">reshape</span><span class="o">&amp;</span><span class="n">permute</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1751</span><span class="p">])</span>
<span class="bp">self</span><span class="p">.</span><span class="n">conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1751</span><span class="p">])</span>
<span class="n">permute</span><span class="o">&amp;</span><span class="n">reshape</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1751</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
<span class="n">period</span><span class="p">:</span> <span class="mi">583</span>
<span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2332</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
<span class="n">reshape</span><span class="o">&amp;</span><span class="n">permute</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">583</span><span class="p">])</span>
<span class="bp">self</span><span class="p">.</span><span class="n">conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">583</span><span class="p">])</span>
<span class="n">permute</span><span class="o">&amp;</span><span class="n">reshape</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2332</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
<span class="n">period</span><span class="p">:</span> <span class="mi">437</span>
<span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2185</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
<span class="n">reshape</span><span class="o">&amp;</span><span class="n">permute</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">437</span><span class="p">])</span>
<span class="bp">self</span><span class="p">.</span><span class="n">conv</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">437</span><span class="p">])</span>
<span class="n">permute</span><span class="o">&amp;</span><span class="n">reshape</span> <span class="n">out</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">2185</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
</code></pre></div> </div> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="p">[:,</span> <span class="p">:(</span><span class="bp">self</span><span class="p">.</span><span class="n">seq_len</span> <span class="o">+</span> <span class="bp">self</span><span class="p">.</span><span class="n">pred_len</span><span class="p">),</span> <span class="p">:])</span>
</code></pre></div></div> <blockquote> <p>这行代码通过 <code class="language-plaintext highlighter-rouge">res.append(out[:, :(self.seq_len + self.pred_len), :])</code> 将处理后的 <code class="language-plaintext highlighter-rouge">out</code> 张量的一个部分添加到列表 <code class="language-plaintext highlighter-rouge">res</code> 中。让我们解释一下：</p> <ul> <li> <p><code class="language-plaintext highlighter-rouge">out[:, :(self.seq_len + self.pred_len), :]</code>: 这部分代码是对 <code class="language-plaintext highlighter-rouge">out</code> 进行切片操作，选择每个样本的前 <code class="language-plaintext highlighter-rouge">(self.seq_len + self.pred_len)</code> 个时间步。具体来说：</p> <ul> <li><code class="language-plaintext highlighter-rouge">[:, :(self.seq_len + self.pred_len), :]</code>: <ul> <li>第一个冒号表示选择所有批次（样本）。</li> <li><code class="language-plaintext highlighter-rouge">:(self.seq_len + self.pred_len)</code> 表示选择前 <code class="language-plaintext highlighter-rouge">(self.seq_len + self.pred_len)</code> 个时间步。</li> <li>最后一个冒号表示选择所有特征（通道）。</li> </ul> </li> </ul> </li> <li> <p><code class="language-plaintext highlighter-rouge">res.append(...)</code>: 这部分将上述切片得到的部分添加到列表 <code class="language-plaintext highlighter-rouge">res</code> 中。</p> </li> </ul> <p>整体而言，这行代码的作用是将处理后的时间序列数据的一个部分，即每个样本的前 <code class="language-plaintext highlighter-rouge">(self.seq_len + self.pred_len)</code> 个时间步，添加到结果列表 <code class="language-plaintext highlighter-rouge">res</code> 中。这样，<code class="language-plaintext highlighter-rouge">res</code> 中将包含每个样本的部分时间序列数据，可能是为了后续的模型训练或其他分析步骤。</p> <p>out before shape： [B, period, N]</p> <p>out after shape： [B, period:(self.seq_len + self.pred_len), N]</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">stack</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># 按最高维 对序列数据内部的张量进行扩维拼接
</span><span class="n">period_weight</span> <span class="o">=</span> <span class="n">F</span><span class="p">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">period_weight</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">period_weight</span> <span class="o">=</span> <span class="n">period_weight</span><span class="p">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">repeat</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</code></pre></div></div> <blockquote> <p>这两行代码涉及到对 <code class="language-plaintext highlighter-rouge">period_weight</code> 张量进行操作，其中 <code class="language-plaintext highlighter-rouge">F</code> 可能是指代 PyTorch 中的函数库（例如 <code class="language-plaintext highlighter-rouge">torch.nn.functional</code>）。让我们逐步解释这两行代码：</p> <ol> <li> <p><code class="language-plaintext highlighter-rouge">period_weight = F.softmax(period_weight, dim=1)</code>: 这一行代码使用 softmax 操作对 <code class="language-plaintext highlighter-rouge">period_weight</code> 进行归一化，使得其每一行的元素都在 (0, 1) 范围内，并且所有行的元素之和为 1。<code class="language-plaintext highlighter-rouge">dim=1</code> 表示在第二个维度上进行 softmax 操作，通常这个维度表示不同的频率。</p> </li> <li> <p><code class="language-plaintext highlighter-rouge">period_weight = period_weight.unsqueeze(1).unsqueeze(1).repeat(1, T, N, 1)</code>: 这一行代码进行了一系列的张量操作：</p> <ul> <li><code class="language-plaintext highlighter-rouge">period_weight.unsqueeze(1).unsqueeze(1)</code>: 通过 <code class="language-plaintext highlighter-rouge">unsqueeze</code> 在第二和第三个维度上插入维度，将 <code class="language-plaintext highlighter-rouge">period_weight</code> 转换为形状 <code class="language-plaintext highlighter-rouge">[B, 1, 1, k]</code>，其中 <code class="language-plaintext highlighter-rouge">B</code> 是批量大小，<code class="language-plaintext highlighter-rouge">k</code> 是振幅最高的前 k 个频率。</li> <li><code class="language-plaintext highlighter-rouge">.repeat(1, T, N, 1)</code>: 通过 <code class="language-plaintext highlighter-rouge">repeat</code> 操作将张量在第一个维度上进行复制，使得最终的形状为 <code class="language-plaintext highlighter-rouge">[B, T, N, k]</code>，其中 <code class="language-plaintext highlighter-rouge">T</code> 是时间步数，<code class="language-plaintext highlighter-rouge">N</code> 是特征数。这样，<code class="language-plaintext highlighter-rouge">period_weight</code> 在每个时间步和特征上都有相同的权重值。</li> </ul> </li> </ol> <p>这样的操作可能是为了将振幅最高的前 k 个频率的权重在时间步和特征上进行扩展，以便后续的加权操作。可能是为了在模型的训练或预测中更好地考虑不同时间步和特征上的频率权重。</p> </blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">res</span> <span class="o">*</span> <span class="n">period_weight</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">res</span> <span class="o">=</span> <span class="n">res</span> <span class="o">+</span> <span class="n">x</span>
</code></pre></div></div> <blockquote> <p>这行代码使用 <code class="language-plaintext highlighter-rouge">torch.sum</code> 对 <code class="language-plaintext highlighter-rouge">res</code> 和 <code class="language-plaintext highlighter-rouge">period_weight</code> 进行加权求和，其中权重由 <code class="language-plaintext highlighter-rouge">period_weight</code> 提供。让我们解释这一行代码：</p> <ul> <li> <p><code class="language-plaintext highlighter-rouge">res * period_weight</code>: 这是一个逐元素的乘法操作，对 <code class="language-plaintext highlighter-rouge">res</code> 中的每个元素分别乘以对应位置上的 <code class="language-plaintext highlighter-rouge">period_weight</code> 中的元素。这实际上是在对每个时间步和特征上的频率分量进行加权。</p> </li> <li> <p><code class="language-plaintext highlighter-rouge">torch.sum(res * period_weight, -1)</code>: 这一步是在最后一个维度上（<code class="language-plaintext highlighter-rouge">-1</code> 表示最后一个维度）对上述乘法结果进行求和。这将得到一个形状为 <code class="language-plaintext highlighter-rouge">[B, T, N]</code> 的张量，其中每个元素表示对应位置上的频率分量经过加权求和后的结果。</p> </li> </ul> <p>整体而言，这行代码的作用是将 <code class="language-plaintext highlighter-rouge">res</code> 中的频率分量按照 <code class="language-plaintext highlighter-rouge">period_weight</code> 中的权重进行加权求和。这可能是为了在模型中更加重视振幅较高的频率分量，或者以某种方式调整时间序列的重要性。</p> </blockquote> <p>维度变换的样例：</p> <blockquote> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">res</span><span class="p">.</span><span class="n">length</span><span class="p">:</span> <span class="mi">3</span>
<span class="n">res</span><span class="p">:{}</span>
<span class="n">res</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1751</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span> <span class="c1"># 按最高维 对序列数据内部的张量进行扩维拼接
</span><span class="n">period_weight</span><span class="p">.</span><span class="n">shape</span> <span class="n">after</span> <span class="n">softmax</span>  <span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">period_weight</span><span class="p">.</span><span class="n">shape</span> <span class="n">after</span> <span class="n">unsqueeze</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1751</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">res</span><span class="p">.</span><span class="n">shape</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="n">Size</span><span class="p">([</span><span class="mi">16</span><span class="p">,</span> <span class="mi">1751</span><span class="p">,</span> <span class="mi">32</span><span class="p">])</span>
</code></pre></div> </div> </blockquote> <div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"> <h3>文档信息</h3> <ul> <li>本文作者：<a href="https://blog.slienceme.cn" target="_blank">slience_me</a></li> <li>本文链接：<a href="https://blog.slienceme.cn/2024/01/19/TimesNet%E4%B9%8BTimesBlock%E8%AF%A6%E8%A7%A3/" target="_blank">https://blog.slienceme.cn/2024/01/19/TimesNet%E4%B9%8BTimesBlock%E8%AF%A6%E8%A7%A3/</a></li> <li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li> </ul> </div> </article> <div class="share"> <div class="share-component" data-disabled='qq,facebook'></div> </div> <div class="comment"> <script src="https://giscus.app/client.js" data-repo="slience-me/blog-comments" data-repo-id="R_kgDOKr27jA" data-category="Announcements" data-category-id="DIC_kwDOKr27jM4CnWMe" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async> </script> </div> </div> <div class="column one-fourth"> <h3>Search</h3> <div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"> </div> <ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul> <script src="https://blog.slienceme.cn/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://blog.slienceme.cn/assets/search_data.json?v=1740598839', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script> <h3 class="post-directory-title mobile-hidden">Table of Contents</h3> <div id="post-directory-module" class="mobile-hidden"> <section class="post-directory"> <dl></dl> </section> </div> <script src="https://blog.slienceme.cn/assets/js/jquery.toc.js"></script> </div> </div> </section> <footer class="container"> <div class="site-footer" role="contentinfo"> <div class="copyright left mobile-block"> Copyright@ 2019-2025 slience_me 版权所有&emsp; <img src="/images/logo/logo.png" class="w-full" style="width: 12px;"> <a href="https://beian.mps.gov.cn/#/query/webSearch?code=13102202000626" rel="noreferrer" target="_blank">冀公网安备13102202000626</a>&emsp; <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" rel="noreferrer">津ICP备2024026565号-1</a> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a> </div> <ul class="site-footer-links right mobile-hidden"> <li> <a href="javascript:window.scrollTo(0,0)" >TOP</a> </li> </ul> <br/> <script defer src="https://vercount.one/js"></script> <div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2024-12-01 </span> </div> </div> </footer> <div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a> </div> <script src="https://blog.slienceme.cn/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script> </body> </html>
