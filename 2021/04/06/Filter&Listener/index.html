<!DOCTYPE html> <html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> <title>Java｜Filter&Listener &mdash; Slience_me的博客</title> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/primer-css/css/primer.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/collection.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/repo-card.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/sections/repo-list.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/boxed-group.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/common.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/responsive.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/posts/index.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/octicons/octicons/octicons.css"> <link rel="stylesheet" href=" https://cdn.jsdelivr.net/npm/@docsearch/css@3 "/> <link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/share.js/dist/css/share.min.css"> <link rel="canonical" href="https://blog.slienceme.cn/2021/04/06/Filter&Listener/"> <link rel="alternate" type="application/atom+xml" title="Slience_me的博客" href="https://blog.slienceme.cn/feed.xml"> <link rel="shortcut icon" href="https://blog.slienceme.cn/favicon.ico"> <meta property="og:title" content="Java｜Filter&Listener"> <meta name="keywords" content="编程语言, Java"> <meta name="og:keywords" content="编程语言, Java"> <meta name="description" content=""> <meta name="og:description" content=""> <meta property="og:url" content="https://blog.slienceme.cn/2021/04/06/Filter&Listener/"> <meta property="og:site_name" content="Slience_me的博客"> <meta property="og:type" content="article"> <meta property="og:locale" content="zh_CN" /> <meta property="article:published_time" content="2021-04-06"> <meta name="google-site-verification" content="2feHjT1GNs1Yi2JQfOtdYx7d048naG_-cMwZaDAopIA" /> <script src="https://blog.slienceme.cn/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/main.js"></script> </head> <body class="" data-mz=""> <header class="site-header"> <div class="container"> <h1><a href="https://blog.slienceme.cn/" title="Slience_me的博客"><span class="octicon octicon-mark-github"></span> Slience_me的博客</a></h1> <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <nav class="site-header-nav" role="navigation"> <a href="https://blog.slienceme.cn/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://blog.slienceme.cn/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://blog.slienceme.cn/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://blog.slienceme.cn/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://blog.slienceme.cn/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://blog.slienceme.cn/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://blog.slienceme.cn/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://blog.slienceme.cn/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://blog.slienceme.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a> </nav> </div> </header> <section class="collection-head small geopattern" data-pattern-id="Java｜Filter&Lis"> <div class="container"> <div class="columns"> <div class="column three-fourths"> <div class="collection-title"> <h1 class="collection-header">Java｜Filter&Listener</h1> <div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/04/06 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://blog.slienceme.cn/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 7017 字，约 21 分钟 </span> </div> </div> </div> <div class="column one-fourth mobile-hidden"> <div class="collection-title"> </div> </div> </div> </div> </section> <section class="container content"> <div class="columns"> <div class="column three-fourths" > <article class="article-content markdown-body"> <p><img src="https://blog.slienceme.cn/images/posts/logo_slienceme3.png" alt="img" /></p> <p>本文作者： <a href="https://slienceme.cn/">slience_me</a></p> <hr /> <h1 id="1-filter-过滤器">1. Filter: 过滤器</h1> <h2 id="11-概念">1.1 概念</h2> <ul> <li>web中的过滤器：访问资源时，过滤器可以拦截，完成特殊的功能。</li> <li>作用： <ul> <li>一般用于完成通用的操作。如：登录验证、统一编码处理、敏感字符过滤…</li> </ul> </li> </ul> <h2 id="12-入门">1.2 入门</h2> <h3 id="步骤">步骤</h3> <ol> <li>定义一个类，实现接口Filter</li> <li>复写方法</li> <li>配置拦截路径 <ol> <li>web.xml</li> <li>注解</li> </ol> </li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">xyz.slienceme.web.filter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.annotation.WebFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>

<span class="cm">/**
 * 过滤器快速入门程序
 */</span>
<span class="nd">@WebFilter</span><span class="o">(</span><span class="s">"/*"</span><span class="o">)</span><span class="c1">//访问所有资源之前，都会执行该过滤器</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterDemo1</span> <span class="kd">implements</span> <span class="nc">Filter</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filterDemo1执行了"</span><span class="o">);</span>

        <span class="c1">//放行</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p>在没有编写 - <code class="language-plaintext highlighter-rouge">//放行filterChain.doFilter(servletRequest,servletResponse);</code>的时候，无法访问到资源，编写后（放行后），可以访问资源。</p> <h2 id="13-深入">1.3 深入</h2> <h3 id="1-webxml配置">1. web.xml配置</h3> <p>等同于添加注解</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebFilter</span><span class="o">(</span><span class="s">"/*"</span><span class="o">)</span><span class="c1">//访问所有资源之前，都会执行该过滤器</span>
</code></pre></div></div> <div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;filter&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>demo1<span class="nt">&lt;/filter-name&gt;</span>
        <span class="nt">&lt;filter-class&gt;</span>xyz.slienceme.web.filter.FilterDemo1<span class="nt">&lt;/filter-class&gt;</span>
    <span class="nt">&lt;/filter&gt;</span>
    <span class="nt">&lt;filter-mapping&gt;</span>
        <span class="nt">&lt;filter-name&gt;</span>demo1<span class="nt">&lt;/filter-name&gt;</span>
        <span class="c">&lt;!--拦截路径--&gt;</span>
        <span class="nt">&lt;url-pattern&gt;</span>/*<span class="nt">&lt;/url-pattern&gt;</span>
    <span class="nt">&lt;/filter-mapping&gt;</span>
</code></pre></div></div> <h3 id="2-过滤器执行流程">2. 过滤器执行流程</h3> <ol> <li>执行过滤器</li> <li>执行放行后的资源</li> <li>回来执行过滤器放行代码下边的代码</li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@WebFilter</span><span class="o">(</span><span class="s">"/*"</span><span class="o">)</span> <span class="c1">//访问所有资源之前，都会执行该过滤器</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterDemo2</span> <span class="kd">implements</span> <span class="nc">Filter</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>

        <span class="c1">//对request对象请求消息增强</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filterDemo2。。。"</span><span class="o">);</span>

        <span class="c1">//放行</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>

        <span class="c1">//对response对象的响应消息增强</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"filterDemo2回来了。。。"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><img src="https://blog.slienceme.cn/images/posts/2021040620270824.png" alt="Alt Text" /></p> <h3 id="3-过滤器生命周期方法">3. 过滤器生命周期方法</h3> <ol> <li><code class="language-plaintext highlighter-rouge">init</code>:在服务器启动后，会创建<code class="language-plaintext highlighter-rouge">Filter</code>对象，然后调用<code class="language-plaintext highlighter-rouge">init</code>方法。只执行一次。用于加载资源</li> <li><code class="language-plaintext highlighter-rouge">doFilter</code>:每一次请求被拦截资源时，会执行。执行多次</li> <li><code class="language-plaintext highlighter-rouge">destroy</code>:在服务器关闭后，<code class="language-plaintext highlighter-rouge">Filter</code>对象被销毁。如果服务器是正常关闭，则会执行<code class="language-plaintext highlighter-rouge">destroy</code>方法。只执行一次。用于释放资源</li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * 过滤器快速入门程序
 */</span>
<span class="c1">//@WebFilter("/*") //访问所有资源之前，都会执行该过滤器</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilterDemo3</span> <span class="kd">implements</span> <span class="nc">Filter</span><span class="o">{</span>

    <span class="cm">/**
     * 在服务器启动后，会创建Filter对象，然后调用init方法，只执行一次。用于加载资源
     * @param filterConfig
     * @throws ServletException
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"init...."</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 每一次请求被拦截资源时，会执行。执行多次
     * @param servletRequest
     * @param servletResponse
     * @param filterChain
     * @throws IOException
     * @throws ServletException
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"doFilter...."</span><span class="o">);</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="cm">/**
     * 在服务器关闭后，Filter对象被销毁。如果服务器是正常关闭，则会执行destroy方法，只执行一次。用于释放资源
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"doDestroy"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><img src="https://blog.slienceme.cn/images/posts/20210406204234760.png" alt="Alt Text" /> <img src="https://blog.slienceme.cn/images/posts/20210406204243242.png" alt="Alt Text" /> <img src="https://blog.slienceme.cn/images/posts/20210406204303113.png" alt="Alt Text" /></p> <h3 id="4-过滤器配置详解">4. 过滤器配置详解</h3> <p>##### 拦截路径配置：</p> <ol> <li><strong>具体资源路径</strong>： <code class="language-plaintext highlighter-rouge">/index.jsp</code> 只有访问index.jsp资源时，过滤器才会被执行</li> <li><strong>拦截目录</strong>： <code class="language-plaintext highlighter-rouge">/user/*</code> 访问/user下的所有资源时，过滤器都会被执行</li> <li><strong>后缀名拦截</strong>： <code class="language-plaintext highlighter-rouge">*.jsp</code> 访问所有后缀名为jsp资源时，过滤器都会被执行</li> <li><strong>拦截所有资源</strong>：<code class="language-plaintext highlighter-rouge">/*</code> 访问所有资源时，过滤器都会被执行</li> </ol> <h5 id="拦截方式配置">拦截方式配置：</h5> <ul> <li>资源被访问的方式</li> <li><strong>注解配置</strong>： <ul> <li>设置<code class="language-plaintext highlighter-rouge">dispatcherTypes</code>属性 <ol> <li><code class="language-plaintext highlighter-rouge">REQUEST</code>：默认值。浏览器直接请求资源</li> <li><code class="language-plaintext highlighter-rouge">FORWARD</code>：转发访问资源</li> <li><code class="language-plaintext highlighter-rouge">INCLUDE</code>：包含访问资源</li> <li><code class="language-plaintext highlighter-rouge">ERROR</code>：错误跳转资源</li> <li><code class="language-plaintext highlighter-rouge">ASYNC</code>：异步访问资源</li> </ol> </li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">web.xml</code>配置 <ul> <li>设置<code class="language-plaintext highlighter-rouge">&lt;dispatcher&gt;&lt;/dispatcher&gt;</code>标签即可</li> </ul> </li> </ul> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//浏览器直接请求资源时，该过滤器会被执行</span>
<span class="nd">@WebFilter</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/*"</span><span class="o">,</span> <span class="n">dispatcherTypes</span> <span class="o">=</span> <span class="nc">DispatcherType</span><span class="o">.</span><span class="na">REQUEST</span><span class="o">)</span> 
<span class="c1">//浏览器转发资源时，该过滤器会被执行</span>
<span class="nd">@WebFilter</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/*"</span><span class="o">,</span> <span class="n">dispatcherTypes</span> <span class="o">=</span> <span class="nc">DispatcherType</span><span class="o">.</span><span class="na">FORWARD</span><span class="o">)</span>
<span class="c1">//浏览器直接请求或转发资源时，该过滤器会被执行</span>
<span class="nd">@WebFilter</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/*"</span><span class="o">,</span> <span class="n">dispatcherTypes</span> <span class="o">=</span> <span class="o">{</span><span class="nc">DispatcherType</span><span class="o">.</span><span class="na">REQUEST</span><span class="o">,</span> <span class="nc">DispatcherType</span><span class="o">.</span><span class="na">FORWARD</span><span class="o">})</span>
</code></pre></div></div> <h3 id="5-过滤器链配置多个过滤器">5. 过滤器链(配置多个过滤器)</h3> <ul> <li>执行顺序：如果有两个过滤器：过滤器1和过滤器2 <ol> <li>过滤器1</li> <li>过滤器2</li> <li>资源执行</li> <li>过滤器2</li> <li>过滤器1</li> </ol> </li> <li>过滤器先后顺序问题： <ol> <li>注解配置：按照类名的字符串比较规则比较，值小的先执行 如： AFilter 和 BFilter，AFilter就先执行了。</li> <li>web.xml配置： <filter-mapping>谁定义在上边，谁先执行</filter-mapping></li> </ol> </li> </ul> <h5 id="增强对象的功能">增强对象的功能：</h5> <ul> <li>设计模式：一些通用的解决固定问题的方式</li> </ul> <ol> <li>装饰模式</li> <li>代理模式 <ul> <li>概念：</li> </ul> </li> <li>真实对象：被代理的对象</li> <li>代理对象：</li> <li>代理模式：代理对象代理真实对象，达到增强真实对象功能的目的 <ul> <li>实现方式：</li> </ul> </li> <li>静态代理：有一个类文件描述代理模式</li> <li>动态代理：在内存中形成代理类 <ul> <li>实现步骤：</li> </ul> <ol> <li>代理对象和真实对象实现相同的接口</li> <li>代理对象 = Proxy.newProxyInstance();</li> <li>使用代理对象调用方法。</li> <li>增强方法</li> </ol> </li> </ol> <ul> <li>增强方式： <ol> <li>增强参数列表</li> <li>增强返回值类型</li> <li>增强方法体执行逻辑</li> </ol> </li> </ul> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">xyz.slienceme.proxy</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">SaleComputer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">sale</span><span class="o">(</span><span class="kt">double</span> <span class="n">money</span><span class="o">);</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">();</span>
<span class="o">}</span>

</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">xyz.slienceme.proxy</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Lenovo</span> <span class="kd">implements</span> <span class="nc">SaleComputer</span><span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">sale</span><span class="o">(</span><span class="kt">double</span> <span class="n">money</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"花了"</span><span class="o">+</span> <span class="n">money</span> <span class="o">+</span><span class="s">"元买了一台联想电脑。。"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"联想电脑"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">show</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"展示电脑..."</span><span class="o">);</span>
    <span class="o">}</span>


<span class="o">}</span>

</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">xyz.slienceme.proxy</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProxyTest</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//1. 创建真实对象</span>
        <span class="nc">Lenovo</span> <span class="n">lenovo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Lenovo</span><span class="o">();</span>

        <span class="c1">//2.动态代理增强lenovo对象</span>
        <span class="cm">/*
            三个参数：
            1. 类加载器：真实对象.getClass().getClassLoader()
            2. 接口数组，真实对象.getClass().getInterfaces()
            3. 处理器，new InvocationHandler()
         */</span>
        <span class="nc">SaleComputer</span> <span class="n">proxy_lenovo</span> <span class="o">=</span> <span class="o">(</span><span class="nc">SaleComputer</span><span class="o">)</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">lenovo</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span> <span class="n">lenovo</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="cm">/*
                代理逻辑编写的方法；代理对象调用的所有方法都会触发该方法执行
                参数：
                    1. proxy：代理对象
                    2. method：代理对象调用的方法，被封装为的对象
                    3. args： 代理对象调用的方法时，传递的参数
             */</span>

            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"该方法执行了"</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">());</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">args</span><span class="o">[</span><span class="mi">0</span><span class="o">]);</span>
                <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span>
        <span class="o">});</span>


        <span class="c1">//3.调用方法</span>
        <span class="nc">String</span> <span class="n">computer</span> <span class="o">=</span> <span class="n">proxy_lenovo</span><span class="o">.</span><span class="na">sale</span><span class="o">(</span><span class="mi">8000</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">computer</span><span class="o">);</span>

<span class="c1">//        proxy_lenovo.show();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">xyz.slienceme.web.filter</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">javax.servlet.annotation.WebFilter</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.BufferedReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileNotFoundException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileReader</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.InvocationHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Method</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.lang.reflect.Proxy</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.List</span><span class="o">;</span>

<span class="cm">/**
 * 敏感词汇过滤器
 */</span>
<span class="nd">@WebFilter</span><span class="o">(</span><span class="s">"/*"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SensitiveWordsFilter</span> <span class="kd">implements</span> <span class="nc">Filter</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;();</span><span class="c1">//敏感词汇的集合</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">init</span><span class="o">(</span><span class="nc">FilterConfig</span> <span class="n">filterConfig</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="c1">// 1. 加载文件</span>
            <span class="nc">ServletContext</span> <span class="n">servletContext</span> <span class="o">=</span> <span class="n">filterConfig</span><span class="o">.</span><span class="na">getServletContext</span><span class="o">();</span>
            <span class="nc">String</span> <span class="n">realPath</span> <span class="o">=</span> <span class="n">servletContext</span><span class="o">.</span><span class="na">getRealPath</span><span class="o">(</span><span class="s">"/WEB-INF/classes/sensitive.txt"</span><span class="o">);</span>
            <span class="c1">// 2. 读取文件</span>
            <span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileReader</span><span class="o">(</span><span class="n">realPath</span><span class="o">));</span>
            <span class="c1">// 3. 将文件的每一行数据添加到list中</span>
            <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
            <span class="k">while</span> <span class="o">((</span><span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">())</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
               <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">br</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>


    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">doFilter</span><span class="o">(</span><span class="nc">ServletRequest</span> <span class="n">servletRequest</span><span class="o">,</span> <span class="nc">ServletResponse</span> <span class="n">servletResponse</span><span class="o">,</span> <span class="nc">FilterChain</span> <span class="n">filterChain</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">ServletException</span> <span class="o">{</span>
        <span class="c1">//1. 创建代理对象，增强getParameter方法</span>
        <span class="nc">ServletRequest</span> <span class="n">proxy_req</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ServletRequest</span><span class="o">)</span> <span class="nc">Proxy</span><span class="o">.</span><span class="na">newProxyInstance</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getClassLoader</span><span class="o">(),</span> <span class="n">servletRequest</span><span class="o">.</span><span class="na">getClass</span><span class="o">().</span><span class="na">getInterfaces</span><span class="o">(),</span> <span class="k">new</span> <span class="nc">InvocationHandler</span><span class="o">()</span> <span class="o">{</span>
            <span class="nd">@Override</span>
            <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">invoke</span><span class="o">(</span><span class="nc">Object</span> <span class="n">proxy</span><span class="o">,</span> <span class="nc">Method</span> <span class="n">method</span><span class="o">,</span> <span class="nc">Object</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
                <span class="c1">//增强getParameter方法</span>
                <span class="c1">//判断是否是getParameter方法</span>
                <span class="k">if</span><span class="o">(</span><span class="n">method</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="s">"getParameter"</span><span class="o">)){</span>
                    <span class="c1">//增强返回值</span>
                    <span class="c1">//获取返回值</span>
                    <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
                    <span class="k">if</span><span class="o">(</span><span class="n">value</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">){</span>
                        <span class="k">for</span><span class="o">(</span><span class="nc">String</span> <span class="n">str</span> <span class="o">:</span> <span class="n">list</span><span class="o">){</span>
                            <span class="k">if</span><span class="o">(</span><span class="n">value</span><span class="o">.</span><span class="na">contains</span><span class="o">(</span><span class="n">str</span><span class="o">)){</span>
                                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="na">replaceAll</span><span class="o">(</span><span class="n">str</span><span class="o">,</span><span class="s">"***"</span><span class="o">);</span>
                            <span class="o">}</span>
                        <span class="o">}</span>
                    <span class="o">}</span>
                    <span class="k">return</span> <span class="n">value</span><span class="o">;</span>
                <span class="o">}</span>
                <span class="c1">//判断方法名是否是getParameterMap</span>



                <span class="k">return</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">servletRequest</span><span class="o">,</span><span class="n">args</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">});</span>
        <span class="c1">//2. 放行</span>
        <span class="n">filterChain</span><span class="o">.</span><span class="na">doFilter</span><span class="o">(</span><span class="n">proxy_req</span><span class="o">,</span><span class="n">servletResponse</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">destroy</span><span class="o">()</span> <span class="o">{</span>

    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <h1 id="2-listener监听器">2. Listener：监听器</h1> <ul> <li>概念：web的三大组件之一。</li> <li>事件监听机制 <ul> <li>事件 ：一件事情</li> <li>事件源 ：事件发生的地方</li> <li>监听器 ：一个对象</li> <li>注册监听：将事件、事件源、监听器绑定在一起。 当事件源上发生某个事件后，执行监听器代码</li> </ul> </li> </ul> <hr /> <ul> <li><code class="language-plaintext highlighter-rouge">ServletContextListener</code>:监听<code class="language-plaintext highlighter-rouge">ServletContext</code>对象的创建和销毁 <ul> <li>方法： <ul> <li><code class="language-plaintext highlighter-rouge">void contextDestroyed(ServletContextEvent sce)</code> ：<code class="language-plaintext highlighter-rouge">ServletContext</code>对象被销毁之前会调用该方法</li> <li><code class="language-plaintext highlighter-rouge">void contextInitialized(ServletContextEvent sce)</code> ：<code class="language-plaintext highlighter-rouge">ServletContext</code>对象创建后会调用该方法</li> </ul> </li> <li>步骤： <ol> <li>定义一个类，实现<code class="language-plaintext highlighter-rouge">ServletContextListener</code>接口</li> <li>复写方法</li> <li> <p>配置</p> <p><code class="language-plaintext highlighter-rouge">web.xml</code> ```xml</p> </li> </ol> </li> </ul> </li> </ul> <listener> <listener-class>xyz.slienceme.web.listener.ContextLoaderListener</listener-class> </listener> <p>```</p> <ul> <li>指定初始化参数<context-param> </context-param> <ol> <li>注解： <code class="language-plaintext highlighter-rouge">@WebListener</code></li> </ol> </li> </ul> <div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"> <h3>文档信息</h3> <ul> <li>本文作者：<a href="https://blog.slienceme.cn" target="_blank">slience_me</a></li> <li>本文链接：<a href="https://blog.slienceme.cn/2021/04/06/Filter&Listener/" target="_blank">https://blog.slienceme.cn/2021/04/06/Filter&Listener/</a></li> <li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li> </ul> </div> </article> <div class="share"> <div class="share-component" data-disabled='qq,facebook'></div> </div> <div class="comment"> <script src="https://giscus.app/client.js" data-repo="slience-me/blog-comments" data-repo-id="R_kgDOKr27jA" data-category="Announcements" data-category-id="DIC_kwDOKr27jM4CnWMe" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async> </script> </div> </div> <div class="column one-fourth"> <h3>Search</h3> <div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"> </div> <ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul> <script src="https://blog.slienceme.cn/assets/js/simple-jekyll-search.min.js"></script> <script src=" https://cdn.jsdelivr.net/npm/@docsearch/js@3 "></script> <script type="text/javascript"> docsearch({ appId: "8W5T6R2WWG", apiKey: "e56e511c7c9f85e2c97e2817664aafb2", indexName: "doc", container: "#search_box", debug: false }); // SimpleJekyllSearch({ // searchInput: document.getElementById('search_box'), // resultsContainer: document.getElementById('search_results'), // // json: 'https://blog.slienceme.cn/assets/search_data.json?v=1740710263', // // searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', // noResultsText: 'No results found', // limit: 10, // fuzzy: false, // exclude: ['Welcome'] // }) </script> <h3 class="post-directory-title mobile-hidden">Table of Contents</h3> <div id="post-directory-module" class="mobile-hidden"> <section class="post-directory"> <dl></dl> </section> </div> <script src="https://blog.slienceme.cn/assets/js/jquery.toc.js"></script> </div> </div> </section> <footer class="container"> <div class="site-footer" role="contentinfo"> <div class="copyright left mobile-block"> <div style="display: flex;align-items: center;justify-content: center;"> <img src="/images/logo/logo.png" class="w-full" style="height: 10px;width: 10px;" alt="logo" />;"> <p> <a href="https://beian.mps.gov.cn/" rel="noreferrer" target="_blank">冀公网安备13102202000626</a> | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noreferrer">津ICP备2024026565号-1</a> </p> </div> <p style="display: flex;align-items: center;justify-content: center;"> Copyright © 2019-present slience_me </p> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a> </div> <ul class="site-footer-links right mobile-hidden"> <li> <a href="javascript:window.scrollTo(0,0)" >TOP</a> </li> </ul> <br/> <script defer src="https://vercount.one/js"></script> <div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2024-12-01 </span> </div> </div> </footer> <div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a> </div> <script src="https://blog.slienceme.cn/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script> </body> </html>
