<!DOCTYPE html> <html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> <title>Java｜Java语言高级（第五部分）网络编程 &mdash; Slience_me的博客</title> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/primer-css/css/primer.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/collection.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/repo-card.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/sections/repo-list.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/boxed-group.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/common.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/responsive.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/posts/index.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/octicons/octicons/octicons.css"> <link rel="stylesheet" href=" https://cdn.jsdelivr.net/npm/@docsearch/css@3 "/> <link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/share.js/dist/css/share.min.css"> <link rel="canonical" href="https://blog.slienceme.cn/2021/01/27/Java%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7-%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"> <link rel="alternate" type="application/atom+xml" title="Slience_me的博客" href="https://blog.slienceme.cn/feed.xml"> <link rel="shortcut icon" href="https://blog.slienceme.cn/favicon.ico"> <meta property="og:title" content="Java｜Java语言高级（第五部分）网络编程"> <meta name="keywords" content="编程语言, Java"> <meta name="og:keywords" content="编程语言, Java"> <meta name="description" content=""> <meta name="og:description" content=""> <meta property="og:url" content="https://blog.slienceme.cn/2021/01/27/Java%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7-%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"> <meta property="og:site_name" content="Slience_me的博客"> <meta property="og:type" content="article"> <meta property="og:locale" content="zh_CN" /> <meta property="article:published_time" content="2021-01-27"> <meta name="google-site-verification" content="2feHjT1GNs1Yi2JQfOtdYx7d048naG_-cMwZaDAopIA" /> <script src="https://blog.slienceme.cn/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/main.js"></script> </head> <body class="" data-mz=""> <header class="site-header"> <div class="container"> <h1><a href="https://blog.slienceme.cn/" title="Slience_me的博客"><span class="octicon octicon-mark-github"></span> Slience_me的博客</a></h1> <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <nav class="site-header-nav" role="navigation"> <a href="https://blog.slienceme.cn/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://blog.slienceme.cn/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://blog.slienceme.cn/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://blog.slienceme.cn/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://blog.slienceme.cn/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://blog.slienceme.cn/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://blog.slienceme.cn/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://blog.slienceme.cn/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://blog.slienceme.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a> </nav> </div> </header> <section class="collection-head small geopattern" data-pattern-id="Java｜Java语言高级（第"> <div class="container"> <div class="columns"> <div class="column three-fourths"> <div class="collection-title"> <h1 class="collection-header">Java｜Java语言高级（第五部分）网络编程</h1> <div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2021/01/27 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://blog.slienceme.cn/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 25776 字，约 74 分钟 </span> </div> </div> </div> <div class="column one-fourth mobile-hidden"> <div class="collection-title"> </div> </div> </div> </div> </section> <section class="container content"> <div class="columns"> <div class="column three-fourths" > <article class="article-content markdown-body"> <p><img src="https://blog.slienceme.cn/images/posts/logo_slienceme3.png" alt="img" /></p> <p>本文作者： <a href="https://slienceme.cn/">slience_me</a></p> <hr /> <h1 id="java语言高级第五部分网络编程">Java语言高级（第五部分）网络编程</h1> <h1 id="第七章-网络编程">第七章 网络编程</h1> <h2 id="1-网络编程入门">1. 网络编程入门</h2> <h3 id="11软件结构">1.1软件结构</h3> <ul> <li><strong>C/S结构</strong> ：全称为Client/Server结构，是指客户端和服务器结构。常见程序有ＱＱ、迅雷等软件。</li> </ul> <p><img src="https://blog.slienceme.cn/images/posts/2021012717475294.jpg" alt="Alt Text" /></p> <p><strong>B/S结构</strong> ：全称为Browser/Server结构，是指浏览器和服务器结构。常见浏览器有谷歌、火狐等。</p> <p><img src="https://blog.slienceme.cn/images/posts/20210127174757914.jpg" alt="Alt Text" /></p> <p>两种架构各有优势，但是无论哪种架构，都离不开网络的支持。<strong>网络编程</strong>，就是在一定的协议下，实现两台计算机的通信的程序。</p> <h3 id="12-网络通信协议">1.2 网络通信协议</h3> <ul> <li> <p><strong>网络通信协议：</strong> 通过计算机网络可以使多台计算机实现连接，位于同一个网络中的计算机在进行连接和通信时需要遵守一定的规则，这就好比在道路中行驶的汽车一定要遵守交通规则一样。在计算机网络中，这些连接和通信的规则被称为网络通信协议，它对数据的传输格式、传输速率、传输步骤等做了统一规定，通信双方必须同时遵守才能完成数据交换。</p> </li> <li> <p><strong>TCP/IP协议：</strong> 传输控制协议/因特网互联协议( Transmission Control Protocol/Internet Protocol)，是Internet最基本、最广泛的协议。它定义了计算机如何连入因特网，以及数据如何在它们之间传输的标准。它的内部包含一系列的用于处理数据通信的协议，并采用了4层的分层模型，每一层都呼叫它的下一层所提供的协议来完成自己的需求。</p> </li> </ul> <p><img src="https://blog.slienceme.cn/images/posts/20210127174805360.jpg" alt="Alt Text" /></p> <p>上图中，TCP/IP协议中的四层分别是应用层、传输层、网络层和链路层，每层分别负责不同的通信功能。 链路层：链路层是用于定义物理传输通道，通常是对某些网络连接设备的驱动协议，例如针对光纤、网线提供的驱动。 网络层：网络层是整个TCP/IP协议的核心，它主要用于将传输的数据进行分组，将分组数据发送到目标计算机或者网络。 运输层：主要使网络程序进行通信，在进行网络通信时，可以采用TCP协议，也可以采用UDP协议。 应用层：主要负责应用程序的协议，例如HTTP协议、FTP协议等。</p> <h3 id="13-协议分类">1.3 协议分类</h3> <p>通信的协议还是比较复杂的，<code class="language-plaintext highlighter-rouge">java.net</code> 包中包含的类和接口，它们提供低层次的通信细节。我们可以直接使用这些类和接口，来专注于网络程序开发，而不用考虑通信的细节。</p> <p><code class="language-plaintext highlighter-rouge">java.net</code> 包中提供了两种常见的网络协议的支持：</p> <ul> <li> <p><strong>UDP</strong>：用户数据报协议(User Datagram Protocol)。UDP是无连接通信协议，即在数据传输时，数据的发送端和接收端不建立逻辑连接。简单来说，当一台计算机向另外一台计算机发送数据时，发送端不会确认接收端是否存在，就会发出数据，同样接收端在收到数据时，也不会向发送端反馈是否收到数据。</p> <p>由于使用UDP协议消耗资源小，通信效率高，所以通常都会用于音频、视频和普通数据的传输例如视频会议都使用UDP协议，因为这种情况即使偶尔丢失一两个数据包，也不会对接收结果产生太大影响。</p> <p>但是在使用UDP协议传送数据时，由于UDP的面向无连接性，不能保证数据的完整性，因此在传输重要数据时不建议使用UDP协议。</p> <p>UDP的交换过程如下图所示</p> </li> </ul> <p><img src="https://blog.slienceme.cn/images/posts/20210127180101629.bmp.jpg" alt="Alt Text" /></p> <p>特点:数据被限制在64kb以内，超出这个范围就不能发送了。</p> <p>数据报(Datagram):网络传输的基本单位</p> <ul> <li> <p><strong>TCP</strong>：传输控制协议 (Transmission Control Protocol)。TCP协议是<strong>面向连接</strong>的通信协议，即传输数据之前，在发送端和接收端建立逻辑连接，然后再传输数据，它提供了两台计算机之间可靠无差错的数据传输。</p> <p>在TCP连接中必须要明确客户端与服务器端，由客户端向服务端发出连接请求，每次连接的创建都需要经过“三次握手”。</p> <ul> <li>三次握手：TCP协议中，在发送数据的准备阶段，客户端与服务器之间的三次交互，以保证连接的可靠。 <ul> <li>第一次握手，客户端向服务器端发出连接请求，等待服务器确认。</li> <li>第二次握手，服务器端向客户端回送一个响应，通知客户端收到了连接请求。</li> <li>第三次握手，客户端再次向服务器端发送确认信息，确认连接。整个交互过程如下图所示。</li> </ul> </li> </ul> </li> </ul> <p><img src="https://blog.slienceme.cn/images/posts/20210127174836316.jpg" alt="Alt Text" /></p> <p>​ 完成三次握手，连接建立后，客户端和服务器就可以开始进行数据传输了。由于这种面向连接的特性，TCP协议可以保证传输数据的安全，所以应用十分广泛，例如下载文件、浏览网页等。</p> <h3 id="14-网络编程三要素">1.4 网络编程三要素</h3> <h4 id="协议">协议</h4> <ul> <li><strong>协议：</strong> 计算机网络通信必须遵守的规则，已经介绍过了，不再赘述。</li> </ul> <h4 id="ip地址">IP地址</h4> <ul> <li><strong>IP地址：指互联网协议地址（Internet Protocol Address）</strong>，俗称IP。IP地址用来给一个网络中的计算机设备做唯一的编号。假如我们把“个人电脑”比作“一台电话”的话，那么“IP地址”就相当于“电话号码”。</li> </ul> <p><strong>IP地址分类</strong></p> <ul> <li> <p>IPv4：是一个32位的二进制数，通常被分为4个字节，表示成<code class="language-plaintext highlighter-rouge">a.b.c.d</code> 的形式，例如<code class="language-plaintext highlighter-rouge">192.168.65.100</code> 。其中a、b、c、d都是0~255之间的十进制整数，那么最多可以表示42亿个。</p> </li> <li> <p>IPv6：由于互联网的蓬勃发展，IP地址的需求量愈来愈大，但是网络地址资源有限，使得IP的分配越发紧张。</p> <p>为了扩大地址空间，拟通过IPv6重新定义地址空间，采用128位地址长度，每16个字节一组，分成8组十六进制数，表示成<code class="language-plaintext highlighter-rouge">ABCD:EF01:2345:6789:ABCD:EF01:2345:6789</code>，号称可以为全世界的每一粒沙子编上一个网址，这样就解决了网络地址资源数量不够的问题。</p> </li> </ul> <p><strong>常用命令</strong></p> <ul> <li>查看本机IP地址，在控制台输入：</li> </ul> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ipconfig</span>
</code></pre></div></div> <ul> <li>检查网络是否连通，在控制台输入：</li> </ul> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">ping</span> <span class="n">空格</span> <span class="nc">IP地址</span>
<span class="n">ping</span> <span class="mf">220.181</span><span class="o">.</span><span class="mf">57.216</span>
</code></pre></div></div> <p><strong>特殊的IP地址</strong></p> <ul> <li>本机IP地址：<code class="language-plaintext highlighter-rouge">127.0.0.1</code>、<code class="language-plaintext highlighter-rouge">localhost</code> 。</li> </ul> <h4 id="端口号">端口号</h4> <p><img src="https://blog.slienceme.cn/images/posts/20210127190006412.bmp.jpg" alt="Alt Text" /></p> <p>网络的通信，本质上是两个进程（应用程序）的通信。每台计算机都有很多的进程，那么在网络通信时，如何区分这些进程呢？</p> <p>如果说<strong>IP地址</strong>可以唯一标识网络中的设备，那么<strong>端口号</strong>就可以唯一标识设备中的进程（应用程序）了。</p> <ul> <li><strong>端口号：用两个字节表示的整数，它的取值范围是0~65535</strong> 其中，0~1023之间的端口号用于一些知名的网络服务和应用，普通的应用程序需要使用1024以上的端口号。如果端口号被另外一个服务或应用所占用，会导致当前程序启动失败。</li> </ul> <p>利用<code class="language-plaintext highlighter-rouge">协议</code>+<code class="language-plaintext highlighter-rouge">IP地址</code>+<code class="language-plaintext highlighter-rouge">端口号</code> 三元组合，就可以标识网络中的进程了，那么进程间的通信就可以利用这个标识与其它进程进行交互。</p> <h2 id="2-tcp通信程序">2. TCP通信程序</h2> <p><img src="https://blog.slienceme.cn/images/posts/20210127191548963.bmp.jpg" alt="Alt Text" /></p> <h3 id="21-概述">2.1 概述</h3> <p>TCP通信能实现两台计算机之间的数据交互，通信的两端，要严格区分为客户端（Client）与服务端（Server）。</p> <p><strong>两端通信时步骤：</strong></p> <ol> <li>服务端程序，需要事先启动，等待客户端的连接。</li> <li>客户端主动连接服务器端，连接成功才能通信。服务端不可以主动连接客户端。</li> </ol> <p><strong>在Java中，提供了两个类用于实现TCP通信程序：</strong></p> <ol> <li>客户端：<code class="language-plaintext highlighter-rouge">java.net.Socket</code> 类表示。创建<code class="language-plaintext highlighter-rouge">Socket</code>对象，向服务端发出连接请求，服务端响应请求，两者建立连接开始通信。</li> <li>服务端：<code class="language-plaintext highlighter-rouge">java.net.ServerSocket</code> 类表示。创建<code class="language-plaintext highlighter-rouge">ServerSocket</code>对象，相当于开启一个服务，并等待客户端的连接。</li> </ol> <h3 id="22-socket类">2.2 Socket类</h3> <p><code class="language-plaintext highlighter-rouge">Socket</code> 类：该类实现客户端套接字，套接字指的是两台设备之间通讯的端点。</p> <h4 id="构造方法">构造方法</h4> <ul> <li> <p><code class="language-plaintext highlighter-rouge">public Socket(String host, int port)</code> :创建套接字对象并将其连接到指定主机上的指定端口号。如果指定的host是null ，则相当于指定地址为回送地址。</p> <blockquote> <p>小贴士：回送地址(127.x.x.x) 是本机回送地址（Loopback Address），主要用于网络软件测试以及本地机进程间通信，无论什么程序，一旦使用回送地址发送数据，立即返回，不进行任何网络传输。</p> </blockquote> </li> </ul> <p>构造举例，代码如下：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Socket</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span> <span class="mi">6666</span><span class="o">);</span>
</code></pre></div></div> <h4 id="成员方法">成员方法</h4> <ul> <li><code class="language-plaintext highlighter-rouge">public InputStream getInputStream()</code> ： 返回此套接字的输入流。 <ul> <li>如果此Scoket具有相关联的通道，则生成的InputStream 的所有操作也关联该通道。</li> <li>关闭生成的InputStream也将关闭相关的Socket。</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">public OutputStream getOutputStream()</code> ： 返回此套接字的输出流。 <ul> <li>如果此Scoket具有相关联的通道，则生成的OutputStream 的所有操作也关联该通道。</li> <li>关闭生成的OutputStream也将关闭相关的Socket。</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">public void close()</code> ：关闭此套接字。 <ul> <li>一旦一个socket被关闭，它不可再使用。</li> <li>关闭此socket也将关闭相关的InputStream和OutputStream 。</li> </ul> </li> <li><code class="language-plaintext highlighter-rouge">public void shutdownOutput()</code> ： 禁用此套接字的输出流。 <ul> <li>任何先前写出的数据将被发送，随后终止输出流。</li> </ul> <h3 id="23-serversocket类">2.3 ServerSocket类</h3> </li> </ul> <p><code class="language-plaintext highlighter-rouge">ServerSocket</code>类：这个类实现了服务器套接字，该对象等待通过网络的请求。</p> <h4 id="构造方法-1">构造方法</h4> <ul> <li><code class="language-plaintext highlighter-rouge">public ServerSocket(int port)</code> ：使用该构造方法在创建ServerSocket对象时，就可以将其绑定到一个指定的端口号上，参数port就是端口号。</li> </ul> <p>构造举例，代码如下：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">6666</span><span class="o">);</span>
</code></pre></div></div> <h4 id="成员方法-1">成员方法</h4> <ul> <li><code class="language-plaintext highlighter-rouge">public Socket accept()</code> ：侦听并接受连接，返回一个新的Socket对象，用于和客户端实现通信。该方法会一直阻塞直到建立连接。</li> </ul> <h3 id="24-简单的tcp网络程序">2.4 简单的TCP网络程序</h3> <h4 id="tcp通信分析图解">TCP通信分析图解</h4> <ol> <li>【服务端】启动,创建ServerSocket对象，等待连接。</li> <li>【客户端】启动,创建Socket对象，请求连接。</li> <li>【服务端】接收连接,调用accept方法，并返回一个Socket对象。</li> <li>【客户端】Socket对象，获取OutputStream，向服务端写出数据。</li> <li>【服务端】Scoket对象，获取InputStream，读取客户端发送的数据。</li> </ol> <blockquote> <p>到此，客户端向服务端发送数据成功。</p> </blockquote> <p><img src="https://blog.slienceme.cn/images/posts/2021012717485061.jpg" alt="Alt Text" /></p> <blockquote> <p>自此，服务端向客户端回写数据。</p> </blockquote> <ol> <li>【服务端】Socket对象，获取OutputStream，向客户端回写数据。</li> <li>【客户端】Scoket对象，获取InputStream，解析回写数据。</li> <li>【客户端】释放资源，断开连接。</li> </ol> <h4 id="客户端向服务器发送数据">客户端向服务器发送数据</h4> <p><strong>服务端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerTCP</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"服务端启动 , 等待连接 .... "</span><span class="o">);</span>
        <span class="c1">// 1.创建 ServerSocket对象，绑定端口，开始等待连接</span>
        <span class="nc">ServerSocket</span> <span class="n">ss</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">6666</span><span class="o">);</span>
        <span class="c1">// 2.接收连接 accept 方法, 返回 socket 对象.</span>
        <span class="nc">Socket</span> <span class="n">server</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="c1">// 3.通过socket 获取输入流</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="c1">// 4.一次性读取数据</span>
      	<span class="c1">// 4.1 创建字节数组</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
      	<span class="c1">// 4.2 据读取到字节数组中.</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">)</span><span class="err">；</span>
        <span class="c1">// 4.3 解析数组,打印字符串信息</span>
        <span class="nc">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
        <span class="c1">//5.关闭资源.</span>
        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>客户端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientTCP</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"客户端 发送数据"</span><span class="o">);</span>
		<span class="c1">// 1.创建 Socket ( ip , port ) , 确定连接到哪里.</span>
		<span class="nc">Socket</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">6666</span><span class="o">);</span>
		<span class="c1">// 2.获取流对象 . 输出流</span>
		<span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
		<span class="c1">// 3.写出数据.</span>
		<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"你好么? tcp ,我来了"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
		<span class="c1">// 4. 关闭资源 .</span>
		<span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h4 id="服务器向客户端回写数据">服务器向客户端回写数据</h4> <p><strong>服务端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerTCP</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"服务端启动 , 等待连接 .... "</span><span class="o">);</span>
        <span class="c1">// 1.创建 ServerSocket对象，绑定端口，开始等待连接</span>
        <span class="nc">ServerSocket</span> <span class="n">ss</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">6666</span><span class="o">);</span>
        <span class="c1">// 2.接收连接 accept 方法, 返回 socket 对象.</span>
        <span class="nc">Socket</span> <span class="n">server</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="c1">// 3.通过socket 获取输入流</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="c1">// 4.一次性读取数据</span>
      	<span class="c1">// 4.1 创建字节数组</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
      	<span class="c1">// 4.2 据读取到字节数组中.</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">)</span><span class="err">；</span>
        <span class="c1">// 4.3 解析数组,打印字符串信息</span>
        <span class="nc">String</span> <span class="n">msg</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
      	<span class="c1">// =================回写数据=======================</span>
      	<span class="c1">// 5. 通过 socket 获取输出流</span>
      	 <span class="nc">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
      	<span class="c1">// 6. 回写数据</span>
      	 <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"我很好,谢谢你"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
      	<span class="c1">// 7.关闭资源.</span>
      	<span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">is</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>客户端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ClientTCP</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
		<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"客户端 发送数据"</span><span class="o">);</span>
		<span class="c1">// 1.创建 Socket ( ip , port ) , 确定连接到哪里.</span>
		<span class="nc">Socket</span> <span class="n">client</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">6666</span><span class="o">);</span>
		<span class="c1">// 2.通过Scoket,获取输出流对象 </span>
		<span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
		<span class="c1">// 3.写出数据.</span>
		<span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"你好么? tcp ,我来了"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
      	<span class="c1">// ==============解析回写=========================</span>
      	<span class="c1">// 4. 通过Scoket,获取 输入流对象</span>
      	<span class="nc">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
      	<span class="c1">// 5. 读取数据数据</span>
      	<span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">100</span><span class="o">];</span>
      	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">);</span>
      	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">));</span>
		<span class="c1">// 6. 关闭资源 .</span>
      	<span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
		<span class="n">client</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <hr /> <hr /> <hr /> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    TCP通信的客户端:向服务器发送连接请求,给服务器发送数据,读取服务器回写的数据
    表示客户端的类:
        java.net.Socket:此类实现客户端套接字（也可以就叫“套接字”）。套接字是两台机器间通信的端点。
        套接字:包含了IP地址和端口号的网络单位

    构造方法:
        Socket(String host, int port) 创建一个流套接字并将其连接到指定主机上的指定端口号。
        参数:
            String host:服务器主机的名称/服务器的IP地址
            int port:服务器的端口号

    成员方法:
        OutputStream getOutputStream() 返回此套接字的输出流。
        InputStream getInputStream() 返回此套接字的输入流。
        void close() 关闭此套接字。

    实现步骤:
        1.创建一个客户端对象Socket,构造方法绑定服务器的IP地址和端口号
        2.使用Socket对象中的方法getOutputStream()获取网络字节输出流OutputStream对象
        3.使用网络字节输出流OutputStream对象中的方法write,给服务器发送数据
        4.使用Socket对象中的方法getInputStream()获取网络字节输入流InputStream对象
        5.使用网络字节输入流InputStream对象中的方法read,读取服务器回写的数据
        6.释放资源(Socket)
     注意:
        1.客户端和服务器端进行交互,必须使用Socket中提供的网络流,不能使用自己创建的流对象
        2.当我们创建客户端对象Socket的时候,就会去请求服务器和服务器经过3次握手建立连接通路
            这时如果服务器没有启动,那么就会抛出异常ConnectException: Connection refused: connect
            如果服务器已经启动,那么就可以进行交互了
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPClient</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.创建一个客户端对象Socket,构造方法绑定服务器的IP地址和端口号</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span><span class="mi">8888</span><span class="o">);</span>
        <span class="c1">//2.使用Socket对象中的方法getOutputStream()获取网络字节输出流OutputStream对象</span>
        <span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="c1">//3.使用网络字节输出流OutputStream对象中的方法write,给服务器发送数据</span>
        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"你好服务器"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

        <span class="c1">//4.使用Socket对象中的方法getInputStream()获取网络字节输入流InputStream对象</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>

        <span class="c1">//5.使用网络字节输入流InputStream对象中的方法read,读取服务器回写的数据</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>

        <span class="c1">//6.释放资源(Socket)</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>

    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    TCP通信的服务器端:接收客户端的请求,读取客户端发送的数据,给客户端回写数据
    表示服务器的类:
        java.net.ServerSocket:此类实现服务器套接字。

    构造方法:
        ServerSocket(int port) 创建绑定到特定端口的服务器套接字。

    服务器端必须明确一件事情,必须的知道是哪个客户端请求的服务器
    所以可以使用accept方法获取到请求的客户端对象Socket
    成员方法:
        Socket accept() 侦听并接受到此套接字的连接。

    服务器的实现步骤:
        1.创建服务器ServerSocket对象和系统要指定的端口号
        2.使用ServerSocket对象中的方法accept,获取到请求的客户端对象Socket
        3.使用Socket对象中的方法getInputStream()获取网络字节输入流InputStream对象
        4.使用网络字节输入流InputStream对象中的方法read,读取客户端发送的数据
        5.使用Socket对象中的方法getOutputStream()获取网络字节输出流OutputStream对象
        6.使用网络字节输出流OutputStream对象中的方法write,给客户端回写数据
        7.释放资源(Socket,ServerSocket)
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPServer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.创建服务器ServerSocket对象和系统要指定的端口号</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
        <span class="c1">//2.使用ServerSocket对象中的方法accept,获取到请求的客户端对象Socket</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="c1">//3.使用Socket对象中的方法getInputStream()获取网络字节输入流InputStream对象</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="c1">//4.使用网络字节输入流InputStream对象中的方法read,读取客户端发送的数据</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
        <span class="c1">//5.使用Socket对象中的方法getOutputStream()获取网络字节输出流OutputStream对象</span>
        <span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="c1">//6.使用网络字节输出流OutputStream对象中的方法write,给客户端回写数据</span>
        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"收到谢谢"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="c1">//7.释放资源(Socket,ServerSocket)</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h2 id="3-综合案例">3. 综合案例</h2> <h3 id="31-文件上传案例">3.1 文件上传案例</h3> <h4 id="文件上传分析图解">文件上传分析图解</h4> <ol> <li>【客户端】输入流，从硬盘读取文件数据到程序中。</li> <li>【客户端】输出流，写出文件数据到服务端。</li> <li>【服务端】输入流，读取文件数据到服务端程序。</li> <li>【服务端】输出流，写出文件数据到服务器硬盘中。</li> </ol> <p><img src="https://blog.slienceme.cn/images/posts/20210127175003402.jpg" alt="Alt Text" /> <img src="https://blog.slienceme.cn/images/posts/20210127194707709.bmp.jpg" alt="Alt Text" /></p> <h5 id="基本实现">基本实现</h5> <p><strong>服务端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileUpload_Server</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"服务器 启动.....  "</span><span class="o">);</span>
        <span class="c1">// 1. 创建服务端ServerSocket</span>
      	<span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">6666</span><span class="o">);</span>
  		<span class="c1">// 2. 建立连接 </span>
        <span class="nc">Socket</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
      	<span class="c1">// 3. 创建流对象</span>
      	<span class="c1">// 3.1 获取输入流,读取文件数据</span>
        <span class="nc">BufferedInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedInputStream</span><span class="o">(</span><span class="n">accept</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
        <span class="c1">// 3.2 创建输出流,保存到本地 .</span>
        <span class="nc">BufferedOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="s">"copy.jpg"</span><span class="o">));</span>
		<span class="c1">// 4. 读写数据</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">8</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span><span class="o">;</span>
        <span class="k">while</span> <span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="c1">//5. 关闭 资源</span>
        <span class="n">bos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">bis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">accept</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件上传已保存"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    文件上传案例的客户端:读取本地文件,上传到服务器,读取服务器回写的数据

    明确:
        数据源:c:\\1.jpg
        目的地:服务器

    实现步骤:
        1.创建一个本地字节输入流FileInputStream对象,构造方法中绑定要读取的数据源
        2.创建一个客户端Socket对象,构造方法中绑定服务器的IP地址和端口号
        3.使用Socket中的方法getOutputStream,获取网络字节输出流OutputStream对象
        4.使用本地字节输入流FileInputStream对象中的方法read,读取本地文件
        5.使用网络字节输出流OutputStream对象中的方法write,把读取到的文件上传到服务器
        6.使用Socket中的方法getInputStream,获取网络字节输入流InputStream对象
        7.使用网络字节输入流InputStream对象中的方法read读取服务回写的数据
        8.释放资源(FileInputStream,Socket)
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPClient</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.创建一个本地字节输入流FileInputStream对象,构造方法中绑定要读取的数据源</span>
        <span class="nc">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"c:\\1.jpg"</span><span class="o">);</span>
        <span class="c1">//2.创建一个客户端Socket对象,构造方法中绑定服务器的IP地址和端口号</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span><span class="mi">8888</span><span class="o">);</span>
        <span class="c1">//3.使用Socket中的方法getOutputStream,获取网络字节输出流OutputStream对象</span>
        <span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="c1">//4.使用本地字节输入流FileInputStream对象中的方法read,读取本地文件</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="c1">//5.使用网络字节输出流OutputStream对象中的方法write,把读取到的文件上传到服务器</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/*
            解决:上传完文件,给服务器写一个结束标记
            void shutdownOutput() 禁用此套接字的输出流。
            对于 TCP 套接字，任何以前写入的数据都将被发送，并且后跟 TCP 的正常连接终止序列。
         */</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">shutdownOutput</span><span class="o">();</span>

        <span class="c1">//6.使用Socket中的方法getInputStream,获取网络字节输入流InputStream对象</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"333333333333333333333"</span><span class="o">);</span>

        <span class="c1">//7.使用网络字节输入流InputStream对象中的方法read读取服务回写的数据</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"444444444444444444  while死循环打印不到"</span><span class="o">);</span>

        <span class="c1">//8.释放资源(FileInputStream,Socket)</span>
        <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>客户端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileUPload_Client</span> <span class="o">{</span>
	<span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// 1.创建流对象</span>
        <span class="c1">// 1.1 创建输入流,读取本地文件  </span>
        <span class="nc">BufferedInputStream</span> <span class="n">bis</span>  <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"test.jpg"</span><span class="o">));</span>
        <span class="c1">// 1.2 创建输出流,写到服务端 </span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">6666</span><span class="o">);</span>
        <span class="nc">BufferedOutputStream</span>   <span class="n">bos</span>   <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>

        <span class="c1">//2.写出数据. </span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span>  <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">;</span> 
        <span class="k">while</span> <span class="o">((</span> <span class="n">len</span>  <span class="o">=</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
            <span class="n">bos</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件发送完毕"</span><span class="o">);</span>
        <span class="c1">// 3.释放资源</span>

        <span class="n">bos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> 
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">bis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span> 
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件上传完毕 "</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    文件上传案例服务器端:读取客户端上传的文件,保存到服务器的硬盘,给客户端回写"上传成功"

    明确:
        数据源:客户端上传的文件
        目的地:服务器的硬盘 d:\\upload\\1.jpg

    实现步骤:
        1.创建一个服务器ServerSocket对象,和系统要指定的端口号
        2.使用ServerSocket对象中的方法accept,获取到请求的客户端Socket对象
        3.使用Socket对象中的方法getInputStream,获取到网络字节输入流InputStream对象
        4.判断d:\\upload文件夹是否存在,不存在则创建
        5.创建一个本地字节输出流FileOutputStream对象,构造方法中绑定要输出的目的地
        6.使用网络字节输入流InputStream对象中的方法read,读取客户端上传的文件
        7.使用本地字节输出流FileOutputStream对象中的方法write,把读取到的文件保存到服务器的硬盘上
        8.使用Socket对象中的方法getOutputStream,获取到网络字节输出流OutputStream对象
        9.使用网络字节输出流OutputStream对象中的方法write,给客户端回写"上传成功"
        10.释放资源(FileOutputStream,Socket,ServerSocket)
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPServer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.创建一个服务器ServerSocket对象,和系统要指定的端口号</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
        <span class="c1">//2.使用ServerSocket对象中的方法accept,获取到请求的客户端Socket对象</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="c1">//3.使用Socket对象中的方法getInputStream,获取到网络字节输入流InputStream对象</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="c1">//4.判断d:\\upload文件夹是否存在,不存在则创建</span>
        <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span>  <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:\\upload"</span><span class="o">);</span>
        <span class="k">if</span><span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
            <span class="n">file</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
        <span class="o">}</span>


        <span class="c1">//5.创建一个本地字节输出流FileOutputStream对象,构造方法中绑定要输出的目的地</span>
        <span class="nc">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">+</span><span class="s">"\\1.jpg"</span><span class="o">);</span>
        <span class="c1">//6.使用网络字节输入流InputStream对象中的方法read,读取客户端上传的文件</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"11111111111111111111"</span><span class="o">);</span>

        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="c1">//7.使用本地字节输出流FileOutputStream对象中的方法write,把读取到的文件保存到服务器的硬盘上</span>
            <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"22222222222222222222222  while死循环打印不到"</span><span class="o">);</span>

        <span class="c1">//8.使用Socket对象中的方法getOutputStream,获取到网络字节输出流OutputStream对象</span>
        <span class="c1">//9.使用网络字节输出流OutputStream对象中的方法write,给客户端回写"上传成功"</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"上传成功"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="c1">//10.释放资源(FileOutputStream,Socket,ServerSocket)</span>
        <span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><img src="https://blog.slienceme.cn/images/posts/20210127200639697.bmp.jpg" alt="Alt Text" /></p> <h4 id="文件上传优化分析">文件上传优化分析</h4> <ol> <li> <p><strong>文件名称写死的问题</strong></p> <p>服务端，保存文件的名称如果写死，那么最终导致服务器硬盘，只会保留一个文件，建议使用系统时间优化，保证文件名称唯一，代码如下：</p> </li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">FileOutputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()+</span><span class="s">".jpg"</span><span class="o">)</span> <span class="c1">// 文件名称</span>
<span class="nc">BufferedOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">fis</span><span class="o">);</span>
</code></pre></div></div> <ol> <li> <p><strong>循环接收的问题</strong></p> <p>服务端，指保存一个文件就关闭了，之后的用户无法再上传，这是不符合实际的，使用循环改进，可以不断的接收不同用户的文件，代码如下：</p> </li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// 每次接收新的连接,创建一个Socket</span>
<span class="k">while</span><span class="err">（</span><span class="kc">true</span><span class="err">）</span><span class="o">{</span>
    <span class="nc">Socket</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
    <span class="o">......</span>
<span class="o">}</span>
</code></pre></div></div> <ol> <li> <p><strong>效率问题</strong></p> <p>服务端，在接收大文件时，可能耗费几秒钟的时间，此时不能接收其他用户上传，所以，使用多线程技术优化，代码如下：</p> </li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">while</span><span class="err">（</span><span class="kc">true</span><span class="err">）</span><span class="o">{</span>
    <span class="nc">Socket</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
    <span class="c1">// accept 交给子线程处理.</span>
    <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
      	<span class="o">......</span>
        <span class="nc">InputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="n">accept</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
      	<span class="o">......</span>
    <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div> <h5 id="优化实现">优化实现</h5> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileUpload_Server</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"服务器 启动.....  "</span><span class="o">);</span>
        <span class="c1">// 1. 创建服务端ServerSocket</span>
        <span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">6666</span><span class="o">);</span>
      	<span class="c1">// 2. 循环接收,建立连接</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Socket</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
          	<span class="cm">/* 
          	3. socket对象交给子线程处理,进行读写操作
               Runnable接口中,只有一个run方法,使用lambda表达式简化格式
            */</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">(</span>
                    <span class="c1">//3.1 获取输入流对象</span>
                    <span class="nc">BufferedInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedInputStream</span><span class="o">(</span><span class="n">accept</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
                    <span class="c1">//3.2 创建输出流对象, 保存到本地 .</span>
                    <span class="nc">FileOutputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="s">".jpg"</span><span class="o">);</span>
                    <span class="nc">BufferedOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">fis</span><span class="o">);)</span> <span class="o">{</span>
                    <span class="c1">// 3.3 读写数据</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">8</span><span class="o">];</span>
                    <span class="kt">int</span> <span class="n">len</span><span class="o">;</span>
                    <span class="k">while</span> <span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                      <span class="n">bos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
                    <span class="o">}</span>
                    <span class="c1">//4. 关闭 资源</span>
                    <span class="n">bos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="n">bis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="n">accept</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件上传已保存"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                  	<span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <hr /> <hr /> <hr /> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.FileInputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.OutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    文件上传案例的客户端:读取本地文件,上传到服务器,读取服务器回写的数据

    明确:
        数据源:c:\\1.jpg
        目的地:服务器

    实现步骤:
        1.创建一个本地字节输入流FileInputStream对象,构造方法中绑定要读取的数据源
        2.创建一个客户端Socket对象,构造方法中绑定服务器的IP地址和端口号
        3.使用Socket中的方法getOutputStream,获取网络字节输出流OutputStream对象
        4.使用本地字节输入流FileInputStream对象中的方法read,读取本地文件
        5.使用网络字节输出流OutputStream对象中的方法write,把读取到的文件上传到服务器
        6.使用Socket中的方法getInputStream,获取网络字节输入流InputStream对象
        7.使用网络字节输入流InputStream对象中的方法read读取服务回写的数据
        8.释放资源(FileInputStream,Socket)
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPClient</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.创建一个本地字节输入流FileInputStream对象,构造方法中绑定要读取的数据源</span>
        <span class="nc">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"c:\\1.jpg"</span><span class="o">);</span>
        <span class="c1">//2.创建一个客户端Socket对象,构造方法中绑定服务器的IP地址和端口号</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"127.0.0.1"</span><span class="o">,</span><span class="mi">8888</span><span class="o">);</span>
        <span class="c1">//3.使用Socket中的方法getOutputStream,获取网络字节输出流OutputStream对象</span>
        <span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="c1">//4.使用本地字节输入流FileInputStream对象中的方法read,读取本地文件</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="c1">//5.使用网络字节输出流OutputStream对象中的方法write,把读取到的文件上传到服务器</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="cm">/*
            解决:上传完文件,给服务器写一个结束标记
            void shutdownOutput() 禁用此套接字的输出流。
            对于 TCP 套接字，任何以前写入的数据都将被发送，并且后跟 TCP 的正常连接终止序列。
         */</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">shutdownOutput</span><span class="o">();</span>

        <span class="c1">//6.使用Socket中的方法getInputStream,获取网络字节输入流InputStream对象</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>



        <span class="c1">//7.使用网络字节输入流InputStream对象中的方法read读取服务回写的数据</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
        <span class="o">}</span>


        <span class="c1">//8.释放资源(FileInputStream,Socket)</span>
        <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.InputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Random</span><span class="o">;</span>

<span class="cm">/*
    文件上传案例服务器端:读取客户端上传的文件,保存到服务器的硬盘,给客户端回写"上传成功"

    明确:
        数据源:客户端上传的文件
        目的地:服务器的硬盘 d:\\upload\\1.jpg

    实现步骤:
        1.创建一个服务器ServerSocket对象,和系统要指定的端口号
        2.使用ServerSocket对象中的方法accept,获取到请求的客户端Socket对象
        3.使用Socket对象中的方法getInputStream,获取到网络字节输入流InputStream对象
        4.判断d:\\upload文件夹是否存在,不存在则创建
        5.创建一个本地字节输出流FileOutputStream对象,构造方法中绑定要输出的目的地
        6.使用网络字节输入流InputStream对象中的方法read,读取客户端上传的文件
        7.使用本地字节输出流FileOutputStream对象中的方法write,把读取到的文件保存到服务器的硬盘上
        8.使用Socket对象中的方法getOutputStream,获取到网络字节输出流OutputStream对象
        9.使用网络字节输出流OutputStream对象中的方法write,给客户端回写"上传成功"
        10.释放资源(FileOutputStream,Socket,ServerSocket)
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPServer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//1.创建一个服务器ServerSocket对象,和系统要指定的端口号</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
        <span class="c1">//2.使用ServerSocket对象中的方法accept,获取到请求的客户端Socket对象</span>

        <span class="cm">/*
            让服务器一直处于监听状态(死循环accept方法)
            有一个客户端上传文件,就保存一个文件
         */</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>

            <span class="cm">/*
                使用多线程技术,提高程序的效率
                有一个客户端上传文件,就开启一个线程,完成文件的上传
             */</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                <span class="c1">//完成文件的上传</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                   <span class="k">try</span> <span class="o">{</span>
                       <span class="c1">//3.使用Socket对象中的方法getInputStream,获取到网络字节输入流InputStream对象</span>
                       <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                       <span class="c1">//4.判断d:\\upload文件夹是否存在,不存在则创建</span>
                       <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span>  <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="s">"d:\\upload"</span><span class="o">);</span>
                       <span class="k">if</span><span class="o">(!</span><span class="n">file</span><span class="o">.</span><span class="na">exists</span><span class="o">()){</span>
                           <span class="n">file</span><span class="o">.</span><span class="na">mkdirs</span><span class="o">();</span>
                       <span class="o">}</span>

                    <span class="cm">/*
                        自定义一个文件的命名规则:防止同名的文件被覆盖
                        规则:域名+毫秒值+随机数
                     */</span>
                       <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">"itdemo"</span><span class="o">+</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()+</span><span class="k">new</span> <span class="nc">Random</span><span class="o">().</span><span class="na">nextInt</span><span class="o">(</span><span class="mi">999999</span><span class="o">)+</span><span class="s">".jpg"</span><span class="o">;</span>

                       <span class="c1">//5.创建一个本地字节输出流FileOutputStream对象,构造方法中绑定要输出的目的地</span>
                       <span class="c1">//FileOutputStream fos = new FileOutputStream(file+"\\1.jpg");</span>
                       <span class="nc">FileOutputStream</span> <span class="n">fos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">+</span><span class="s">"\\"</span><span class="o">+</span><span class="n">fileName</span><span class="o">);</span>
                       <span class="c1">//6.使用网络字节输入流InputStream对象中的方法read,读取客户端上传的文件</span>


                       <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span>
                       <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
                       <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">is</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
                           <span class="c1">//7.使用本地字节输出流FileOutputStream对象中的方法write,把读取到的文件保存到服务器的硬盘上</span>
                           <span class="n">fos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
                       <span class="o">}</span>


                       <span class="c1">//8.使用Socket对象中的方法getOutputStream,获取到网络字节输出流OutputStream对象</span>
                       <span class="c1">//9.使用网络字节输出流OutputStream对象中的方法write,给客户端回写"上传成功"</span>
                       <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">().</span><span class="na">write</span><span class="o">(</span><span class="s">"上传成功"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                       <span class="c1">//10.释放资源(FileOutputStream,Socket,ServerSocket)</span>
                       <span class="n">fos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                       <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                   <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">){</span>
                       <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">e</span><span class="o">);</span>
                   <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}).</span><span class="na">start</span><span class="o">();</span>


        <span class="o">}</span>

        <span class="c1">//服务器就不用关闭</span>
        <span class="c1">//server.close();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <h4 id="信息回写分析图解">信息回写分析图解</h4> <p>前四步与基本文件上传一致.</p> <ol> <li>【服务端】获取输出流，回写数据。</li> <li>【客户端】获取输入流，解析回写数据。</li> </ol> <p><img src="https://blog.slienceme.cn/images/posts/20210127175021420.jpg" alt="Alt Text" /></p> <h5 id="回写实现">回写实现</h5> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileUpload_Server</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"服务器 启动.....  "</span><span class="o">);</span>
        <span class="c1">// 1. 创建服务端ServerSocket</span>
        <span class="nc">ServerSocket</span> <span class="n">serverSocket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">6666</span><span class="o">);</span>
        <span class="c1">// 2. 循环接收,建立连接</span>
        <span class="k">while</span> <span class="o">(</span><span class="kc">true</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">Socket</span> <span class="n">accept</span> <span class="o">=</span> <span class="n">serverSocket</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
          	<span class="cm">/*
          	3. socket对象交给子线程处理,进行读写操作
               Runnable接口中,只有一个run方法,使用lambda表达式简化格式
            */</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">try</span> <span class="o">(</span>
                    <span class="c1">//3.1 获取输入流对象</span>
                    <span class="nc">BufferedInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedInputStream</span><span class="o">(</span><span class="n">accept</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">());</span>
                    <span class="c1">//3.2 创建输出流对象, 保存到本地 .</span>
                    <span class="nc">FileOutputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">+</span> <span class="s">".jpg"</span><span class="o">);</span>
                    <span class="nc">BufferedOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">fis</span><span class="o">);</span>
                <span class="o">)</span> <span class="o">{</span>
                    <span class="c1">// 3.3 读写数据</span>
                    <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">8</span><span class="o">];</span>
                    <span class="kt">int</span> <span class="n">len</span><span class="o">;</span>
                    <span class="k">while</span> <span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
                        <span class="n">bos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
                    <span class="o">}</span>

                    <span class="c1">// 4.=======信息回写===========================</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"back ........"</span><span class="o">);</span>
                    <span class="nc">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">accept</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                    <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"上传成功"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                    <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="c1">//================================</span>

                    <span class="c1">//5. 关闭 资源</span>
                    <span class="n">bos</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="n">bis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="n">accept</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件上传已保存"</span><span class="o">);</span>
                <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
                    <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                <span class="o">}</span>
            <span class="o">}).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <p><strong>客户端实现：</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">FileUpload_Client</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">// 1.创建流对象</span>
        <span class="c1">// 1.1 创建输入流,读取本地文件</span>
        <span class="nc">BufferedInputStream</span> <span class="n">bis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedInputStream</span><span class="o">(</span><span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="s">"test.jpg"</span><span class="o">));</span>
        <span class="c1">// 1.2 创建输出流,写到服务端</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Socket</span><span class="o">(</span><span class="s">"localhost"</span><span class="o">,</span> <span class="mi">6666</span><span class="o">);</span>
        <span class="nc">BufferedOutputStream</span> <span class="n">bos</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>

        <span class="c1">//2.写出数据.</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">b</span>  <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span> <span class="o">*</span> <span class="mi">8</span> <span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">;</span>
        <span class="k">while</span> <span class="o">((</span> <span class="n">len</span>  <span class="o">=</span> <span class="n">bis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">b</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">bos</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">b</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>
      	<span class="c1">// 关闭输出流,通知服务端,写出数据完毕</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">shutdownOutput</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件发送完毕"</span><span class="o">);</span>
        <span class="c1">// 3. =====解析回写============</span>
        <span class="nc">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">back</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">20</span><span class="o">];</span>
        <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">back</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">back</span><span class="o">));</span>
        <span class="n">in</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="c1">// ============================</span>

        <span class="c1">// 4.释放资源</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">bis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h3 id="32-模拟bs服务器扩展知识点">3.2 模拟B\S服务器(扩展知识点)</h3> <p>模拟网站服务器，使用浏览器访问自己编写的服务端程序，查看网页效果。</p> <p><img src="https://blog.slienceme.cn/images/posts/202101272030550.bmp.jpg" alt="Alt Text" /></p> <h4 id="案例分析">案例分析</h4> <ol> <li> <p>准备页面数据，web文件夹。</p> <p>复制到我们Module中，比如复制到day08中</p> </li> </ol> <p><img src="https://blog.slienceme.cn/images/posts/20210127175109185.png" alt="Alt Text" /></p> <ol> <li>我们模拟服务器端，ServerSocket类监听端口，使用浏览器访问</li> </ol> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
       	<span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8000</span><span class="o">);</span>
       	<span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
       	<span class="nc">InputStream</span> <span class="n">in</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
      	    <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
       	<span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">in</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">);</span>
       	<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">));</span>
       	<span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
       	<span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
   <span class="o">}</span>
</code></pre></div></div> <p><img src="https://blog.slienceme.cn/images/posts/20210127175140595.jpg" alt="Alt Text" /></p> <ol> <li>服务器程序中字节输入流可以读取到浏览器发来的请求信息</li> </ol> <p><img src="https://blog.slienceme.cn/images/posts/20210127175147523.jpg" alt="Alt Text" /></p> <p>GET/web/index.html HTTP/1.1是浏览器的请求消息。/web/index.html为浏览器想要请求的服务器端的资源,使用字符串切割方式获取到请求的资源。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//转换流,读取浏览器请求第一行</span>
<span class="nc">BufferedReader</span> <span class="n">readWb</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
<span class="nc">String</span> <span class="n">requst</span> <span class="o">=</span> <span class="n">readWb</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
<span class="c1">//取出请求资源的路径</span>
<span class="nc">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="n">requst</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
<span class="c1">//去掉web前面的/</span>
<span class="nc">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">strArr</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
<span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
</code></pre></div></div> <h4 id="案例实现">案例实现</h4> <p>服务端实现：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">SerDemo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"服务端  启动 , 等待连接 .... "</span><span class="o">);</span>
        <span class="c1">// 创建ServerSocket 对象</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="c1">// 转换流读取浏览器的请求消息</span>
        <span class="nc">BufferedReader</span> <span class="n">readWb</span> <span class="o">=</span> <span class="k">new</span>
        <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
        <span class="nc">String</span> <span class="n">requst</span> <span class="o">=</span> <span class="n">readWb</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="c1">// 取出请求资源的路径</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="n">requst</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
        <span class="c1">// 去掉web前面的/</span>
        <span class="nc">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">strArr</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="c1">// 读取客户端请求的资源文件</span>
        <span class="nc">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span>
        <span class="c1">// 字节输出流,将文件写会客户端</span>
        <span class="nc">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="c1">// 写入HTTP协议响应头,固定写法</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"HTTP/1.1 200 OK\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"Content-Type:text/html\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="c1">// 必须要写入空行,否则浏览器不解析</span>
        <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">readWb</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>	
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <h4 id="访问效果">访问效果</h4> <ul> <li><strong>火狐</strong></li> </ul> <p><img src="https://blog.slienceme.cn/images/posts/20210127175201968.png" alt="Alt Text" /></p> <blockquote> <p>小贴士：不同的浏览器，内核不一样，解析效果有可能不一样。</p> </blockquote> <p>发现浏览器中出现很多的叉子,说明浏览器没有读取到图片信息导致。</p> <p>浏览器工作原理是遇到图片会开启一个线程进行单独的访问,因此在服务器端加入线程技术。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">ServerDemo</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8888</span><span class="o">);</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Web</span><span class="o">(</span><span class="n">socket</span><span class="o">)).</span><span class="na">start</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Web</span> <span class="kd">implements</span> <span class="nc">Runnable</span><span class="o">{</span>
        <span class="kd">private</span> <span class="nc">Socket</span> <span class="n">socket</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Web</span><span class="o">(</span><span class="nc">Socket</span> <span class="n">socket</span><span class="o">){</span>
            <span class="k">this</span><span class="o">.</span><span class="na">socket</span><span class="o">=</span><span class="n">socket</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">try</span><span class="o">{</span>
                <span class="c1">//转换流,读取浏览器请求第一行</span>
                <span class="nc">BufferedReader</span> <span class="n">readWb</span> <span class="o">=</span> <span class="k">new</span>
                        <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">()));</span>
                <span class="nc">String</span> <span class="n">requst</span> <span class="o">=</span> <span class="n">readWb</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                <span class="c1">//取出请求资源的路径</span>
                <span class="nc">String</span><span class="o">[]</span> <span class="n">strArr</span> <span class="o">=</span> <span class="n">requst</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="nc">Arrays</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">strArr</span><span class="o">));</span>
                <span class="nc">String</span> <span class="n">path</span> <span class="o">=</span> <span class="n">strArr</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>

                <span class="nc">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">path</span><span class="o">);</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">fis</span><span class="o">);</span>
                <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span><span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
                <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span> <span class="o">;</span>
                <span class="c1">//向浏览器 回写数据</span>
                <span class="nc">OutputStream</span> <span class="n">out</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
                <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"HTTP/1.1 200 OK\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"Content-Type:text/html\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
                    <span class="n">out</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
                <span class="o">}</span>
                <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="n">out</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="n">readWb</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="nc">Exception</span> <span class="n">ex</span><span class="o">){</span>

            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <p><strong>访问效果：</strong></p> <p><img src="https://blog.slienceme.cn/images/posts/20210127175219516.png" alt="Alt Text" /></p> <p>图解：</p> <p><img src="https://blog.slienceme.cn/images/posts/20210127175229572.bmp.jpg" alt="Alt Text" /></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    创建BS版本TCP服务器
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPServer</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//创建一个服务器ServerSocket,和系统要指定的端口号</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
        <span class="c1">//使用accept方法获取到请求的客户端对象(浏览器)</span>
        <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>
        <span class="c1">//使用Socket对象中的方法getInputStream,获取到网络字节输入流InputStream对象</span>
        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
        <span class="c1">//使用网络字节输入流InputStream对象中的方法read读取客户端的请求信息</span>
        <span class="cm">/*byte[] bytes = new byte[1024];
        int len = 0;
        while((len = is.read(bytes))!=-1){
            System.out.println(new String(bytes,0,len));
        }*/</span>

        <span class="c1">//把is网络字节输入流对象,转换为字符缓冲输入流</span>
        <span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>
        <span class="c1">//把客户端请求信息的第一行读取出来 GET /11_Net/web/index.html HTTP/1.1</span>
        <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
        <span class="c1">//把读取的信息进行切割,只要中间部分 /11_Net/web/index.html</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
        <span class="c1">//把路径前边的/去掉,进行截取 11_Net/web/index.html</span>
        <span class="nc">String</span> <span class="n">htmlpath</span> <span class="o">=</span> <span class="n">arr</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

        <span class="c1">//创建一个本地字节输入流,构造方法中绑定要读取的html路径</span>
        <span class="nc">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">htmlpath</span><span class="o">);</span>
        <span class="c1">//使用Socket中的方法getOutputStream获取网络字节输出流OutputStream对象</span>
        <span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

        <span class="c1">// 写入HTTP协议响应头,固定写法</span>
        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"HTTP/1.1 200 OK\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"Content-Type:text/html\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
        <span class="c1">// 必须要写入空行,否则浏览器不解析</span>
        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

        <span class="c1">//一读一写复制文件,把服务读取的html文件回写到客户端</span>
        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//释放资源</span>
        <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="n">server</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">java.io.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.ServerSocket</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.net.Socket</span><span class="o">;</span>

<span class="cm">/*
    创建BS版本TCP服务器
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TCPServerThread</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span> <span class="o">{</span>
        <span class="c1">//创建一个服务器ServerSocket,和系统要指定的端口号</span>
        <span class="nc">ServerSocket</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ServerSocket</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>

        <span class="cm">/*
            浏览器解析服务器回写的html页面,页面中如果有图片,那么浏览器就会单独的开启一个线程,读取服务器的图片
            我们就的让服务器一直处于监听状态,客户端请求一次,服务器就回写一次
         */</span>
        <span class="k">while</span><span class="o">(</span><span class="kc">true</span><span class="o">){</span>
            <span class="c1">//使用accept方法获取到请求的客户端对象(浏览器)</span>
            <span class="nc">Socket</span> <span class="n">socket</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="na">accept</span><span class="o">();</span>

            <span class="k">new</span> <span class="nf">Thread</span><span class="o">(</span><span class="k">new</span> <span class="nc">Runnable</span><span class="o">()</span> <span class="o">{</span>
                <span class="nd">@Override</span>
                <span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">()</span> <span class="o">{</span>
                    <span class="k">try</span> <span class="o">{</span>
                        <span class="c1">//使用Socket对象中的方法getInputStream,获取到网络字节输入流InputStream对象</span>
                        <span class="nc">InputStream</span> <span class="n">is</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getInputStream</span><span class="o">();</span>
                        <span class="c1">//使用网络字节输入流InputStream对象中的方法read读取客户端的请求信息</span>
                        <span class="cm">/*byte[] bytes = new byte[1024];
                        int len = 0;
                        while((len = is.read(bytes))!=-1){
                            System.out.println(new String(bytes,0,len));
                        }*/</span>

                        <span class="c1">//把is网络字节输入流对象,转换为字符缓冲输入流</span>
                        <span class="nc">BufferedReader</span> <span class="n">br</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedReader</span><span class="o">(</span><span class="k">new</span> <span class="nc">InputStreamReader</span><span class="o">(</span><span class="n">is</span><span class="o">));</span>
                        <span class="c1">//把客户端请求信息的第一行读取出来 GET /11_Net/web/index.html HTTP/1.1</span>
                        <span class="nc">String</span> <span class="n">line</span> <span class="o">=</span> <span class="n">br</span><span class="o">.</span><span class="na">readLine</span><span class="o">();</span>
                        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">line</span><span class="o">);</span>
                        <span class="c1">//把读取的信息进行切割,只要中间部分 /11_Net/web/index.html</span>
                        <span class="nc">String</span><span class="o">[]</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="na">split</span><span class="o">(</span><span class="s">" "</span><span class="o">);</span>
                        <span class="c1">//把路径前边的/去掉,进行截取 11_Net/web/index.html</span>
                        <span class="nc">String</span> <span class="n">htmlpath</span> <span class="o">=</span> <span class="n">arr</span><span class="o">[</span><span class="mi">1</span><span class="o">].</span><span class="na">substring</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>

                        <span class="c1">//创建一个本地字节输入流,构造方法中绑定要读取的html路径</span>
                        <span class="nc">FileInputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">htmlpath</span><span class="o">);</span>
                        <span class="c1">//使用Socket中的方法getOutputStream获取网络字节输出流OutputStream对象</span>
                        <span class="nc">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>

                        <span class="c1">// 写入HTTP协议响应头,固定写法</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"HTTP/1.1 200 OK\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"Content-Type:text/html\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>
                        <span class="c1">// 必须要写入空行,否则浏览器不解析</span>
                        <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="s">"\r\n"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">());</span>

                        <span class="c1">//一读一写复制文件,把服务读取的html文件回写到客户端</span>
                        <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                        <span class="kt">byte</span><span class="o">[]</span> <span class="n">bytes</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="mi">1024</span><span class="o">];</span>
                        <span class="k">while</span><span class="o">((</span><span class="n">len</span> <span class="o">=</span> <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">bytes</span><span class="o">))!=-</span><span class="mi">1</span><span class="o">){</span>
                            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">bytes</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">len</span><span class="o">);</span>
                        <span class="o">}</span>

                        <span class="c1">//释放资源</span>
                        <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                        <span class="n">socket</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                    <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="nc">IOException</span> <span class="n">e</span><span class="o">){</span>
                        <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
                    <span class="o">}</span>
                <span class="o">}</span>
            <span class="o">}).</span><span class="na">start</span><span class="o">();</span>


        <span class="o">}</span>


        <span class="c1">//server.close();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"> <h3>文档信息</h3> <ul> <li>本文作者：<a href="https://blog.slienceme.cn" target="_blank">slience_me</a></li> <li>本文链接：<a href="https://blog.slienceme.cn/2021/01/27/Java%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7-%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" target="_blank">https://blog.slienceme.cn/2021/01/27/Java%E8%AF%AD%E8%A8%80%E9%AB%98%E7%BA%A7-%E7%AC%AC%E4%BA%94%E9%83%A8%E5%88%86-%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</a></li> <li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li> </ul> </div> </article> <div class="share"> <div class="share-component" data-disabled='qq,facebook'></div> </div> <div class="comment"> <script src="https://giscus.app/client.js" data-repo="slience-me/blog-comments" data-repo-id="R_kgDOKr27jA" data-category="Announcements" data-category-id="DIC_kwDOKr27jM4CnWMe" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async> </script> </div> </div> <div class="column one-fourth"> <h3>Search</h3> <div id="site_search"> <div id="docsearch"></div> </div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script type="text/javascript"> import docsearch from '@docsearch/js'; docsearch({ appId: "8W5T6R2WWG", apiKey: "e56e511c7c9f85e2c97e2817664aafb2", indexName: "doc", container: "#docsearch", debug: false }); </script> <h3 class="post-directory-title mobile-hidden">Table of Contents</h3> <div id="post-directory-module" class="mobile-hidden"> <section class="post-directory"> <dl></dl> </section> </div> <script src="https://blog.slienceme.cn/assets/js/jquery.toc.js"></script> </div> </div> </section> <footer class="container"> <div class="site-footer" role="contentinfo"> <div class="copyright left mobile-block"> <div style="display: flex;align-items: center;justify-content: center;"> <img src="/images/logo/logo.png" class="w-full" style="height: 10px;width: 10px;" alt="logo" />;"> <p> <a href="https://beian.mps.gov.cn/" rel="noreferrer" target="_blank">冀公网安备13102202000626</a> | <a href="https://beian.miit.gov.cn/" target="_blank" rel="noreferrer">津ICP备2024026565号-1</a> </p> </div> <p style="display: flex;align-items: center;justify-content: center;"> Copyright © 2019-present slience_me </p> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a> </div> <ul class="site-footer-links right mobile-hidden"> <li> <a href="javascript:window.scrollTo(0,0)" >TOP</a> </li> </ul> <br/> <script defer src="https://vercount.one/js"></script> <div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2024-12-01 </span> </div> </div> </footer> <div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a> </div> <script src="https://blog.slienceme.cn/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script> </body> </html>
