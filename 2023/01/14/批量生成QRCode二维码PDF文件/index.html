<!DOCTYPE html> <html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> <title>Java｜批量生成QRCode二维码PDF文件 &mdash; Slience_me的博客</title> <link rel="stylesheet" href="https://slienceme.cn/assets/vendor/primer-css/css/primer.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/components/collection.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/components/repo-card.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/sections/repo-list.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/components/boxed-group.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/globals/common.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/globals/responsive.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/css/posts/index.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/vendor/octicons/octicons/octicons.css"> <link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"> <link rel="stylesheet" href="https://slienceme.cn/assets/vendor/share.js/dist/css/share.min.css"> <link rel="canonical" href="https://slienceme.cn/2023/01/14/%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90QRCode%E4%BA%8C%E7%BB%B4%E7%A0%81PDF%E6%96%87%E4%BB%B6/"> <link rel="alternate" type="application/atom+xml" title="Slience_me的博客" href="https://slienceme.cn/feed.xml"> <link rel="shortcut icon" href="https://slienceme.cn/favicon.ico"> <meta property="og:title" content="Java｜批量生成QRCode二维码PDF文件"> <meta name="keywords" content="编程语言, Java"> <meta name="og:keywords" content="编程语言, Java"> <meta name="description" content="需求：导出产品二维码PDF文件"> <meta name="og:description" content="需求：导出产品二维码PDF文件"> <meta property="og:url" content="https://slienceme.cn/2023/01/14/%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90QRCode%E4%BA%8C%E7%BB%B4%E7%A0%81PDF%E6%96%87%E4%BB%B6/"> <meta property="og:site_name" content="Slience_me的博客"> <meta property="og:type" content="article"> <meta property="og:locale" content="zh_CN" /> <meta property="article:published_time" content="2023-01-14"> <meta name="google-site-verification" content="2feHjT1GNs1Yi2JQfOtdYx7d048naG_-cMwZaDAopIA" /> <script src="https://slienceme.cn/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://slienceme.cn/assets/js/main.js"></script> </head> <body class="" data-mz=""> <header class="site-header"> <div class="container"> <h1><a href="https://slienceme.cn/" title="Slience_me的博客"><span class="octicon octicon-mark-github"></span> Slience_me的博客</a></h1> <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <nav class="site-header-nav" role="navigation"> <a href="https://slienceme.cn/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://slienceme.cn/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://slienceme.cn/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://slienceme.cn/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://slienceme.cn/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://slienceme.cn/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://slienceme.cn/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://slienceme.cn/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://slienceme.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a> </nav> </div> </header> <section class="collection-head small geopattern" data-pattern-id="Java｜批量生成QRCode"> <div class="container"> <div class="columns"> <div class="column three-fourths"> <div class="collection-title"> <h1 class="collection-header">Java｜批量生成QRCode二维码PDF文件</h1> <div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2023/01/14 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://slienceme.cn/categories/#Java" title="Java">Java</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 6829 字，约 20 分钟 </span> </div> </div> </div> <div class="column one-fourth mobile-hidden"> <div class="collection-title"> </div> </div> </div> </div> </section> <section class="container content"> <div class="columns"> <div class="column three-fourths" > <article class="article-content markdown-body"> <h2 id="需求导出产品二维码pdf文件">需求：导出产品二维码PDF文件</h2> <h3 id="1-anchor设置页眉标题">1. Anchor设置页眉标题</h3> <p><img src="https://slienceme.cn/images/posts/751056a711e14a6a9a1461c4877fda37.png" alt="Alt Text" /></p> <h2 id="工具包">工具包</h2> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @title PdfReport
 * @description wms-parent
 * @author slience_me
 * @version 1.0.0
 * @since 2023/1/13 14:08
 */</span>
<span class="kn">package</span> <span class="nn">xyz.slienceme.utils.pdf</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.itextpdf.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.draw.DottedLineSeparator</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.draw.LineSeparator</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.FileOutputStream</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Objects</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PdfReport</span> <span class="o">{</span>

    <span class="c1">// 定义全局的字体静态变量</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Font</span> <span class="n">titlefont</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Font</span> <span class="n">headfont</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Font</span> <span class="n">keyfont</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="nc">Font</span> <span class="n">textfont</span><span class="o">;</span>
    <span class="c1">// 最大宽度</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">int</span> <span class="n">maxWidth</span> <span class="o">=</span> <span class="mi">520</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generateQRCodePDF</span><span class="o">(</span><span class="nc">Document</span> <span class="n">document</span><span class="o">,</span> <span class="nc">File</span> <span class="n">filePath</span><span class="o">,</span> <span class="nc">File</span> <span class="n">fontPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">"SimHei.ttf"</span><span class="o">;</span>
        <span class="nc">File</span> <span class="n">fontFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">fontPath</span><span class="o">,</span> <span class="n">filename</span><span class="o">);</span>
        <span class="nc">BaseFont</span> <span class="n">bfChinese</span> <span class="o">=</span> <span class="nc">BaseFont</span><span class="o">.</span><span class="na">createFont</span><span class="o">(</span><span class="n">fontFile</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">(),</span> <span class="nc">BaseFont</span><span class="o">.</span><span class="na">IDENTITY_H</span><span class="o">,</span> <span class="nc">BaseFont</span><span class="o">.</span><span class="na">NOT_EMBEDDED</span><span class="o">);</span>
        <span class="n">titlefont</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Font</span><span class="o">(</span><span class="n">bfChinese</span><span class="o">,</span> <span class="mi">16</span><span class="o">,</span> <span class="nc">Font</span><span class="o">.</span><span class="na">BOLD</span><span class="o">);</span>
        <span class="nc">Paragraph</span> <span class="n">paragraph</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Paragraph</span><span class="o">(</span><span class="s">"产品二维码导出"</span><span class="o">,</span> <span class="n">titlefont</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setAlignment</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setIndentationLeft</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setIndentationRight</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setFirstLineIndent</span><span class="o">(</span><span class="mi">24</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setLeading</span><span class="o">(</span><span class="mi">20</span><span class="n">f</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setSpacingBefore</span><span class="o">(</span><span class="mi">5</span><span class="n">f</span><span class="o">);</span>
        <span class="n">paragraph</span><span class="o">.</span><span class="na">setSpacingAfter</span><span class="o">(</span><span class="mi">10</span><span class="n">f</span><span class="o">);</span>
        <span class="nc">Anchor</span> <span class="n">anchor</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Anchor</span><span class="o">(</span><span class="s">"设置页眉标题"</span><span class="o">);</span>
        <span class="n">anchor</span><span class="o">.</span><span class="na">setReference</span><span class="o">(</span><span class="s">"超链接"</span><span class="o">);</span>
        <span class="nc">PdfPTable</span> <span class="n">table</span> <span class="o">=</span> <span class="n">createTable</span><span class="o">(</span><span class="k">new</span> <span class="kt">float</span><span class="o">[]{</span><span class="mi">280</span><span class="o">,</span> <span class="mi">280</span><span class="o">});</span><span class="c1">//两列每个280</span>
        <span class="nc">File</span><span class="o">[]</span> <span class="n">files</span> <span class="o">=</span> <span class="n">filePath</span><span class="o">.</span><span class="na">listFiles</span><span class="o">();</span><span class="c1">//文件列表</span>
        <span class="nc">PdfPCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfPCell</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Objects</span><span class="o">.</span><span class="na">nonNull</span><span class="o">(</span><span class="n">files</span><span class="o">)){</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"生成二维码PDF文件,  总共:"</span><span class="o">+</span><span class="n">files</span><span class="o">.</span><span class="na">length</span><span class="o">+</span><span class="s">"个文件"</span><span class="o">);</span>
            <span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
            <span class="k">for</span> <span class="o">(</span><span class="nc">File</span> <span class="n">file</span> <span class="o">:</span> <span class="n">files</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="n">i</span><span class="o">++);</span> <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">"-&gt;"</span><span class="o">);</span>
                <span class="nc">Image</span> <span class="n">image</span> <span class="o">=</span> <span class="nc">Image</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">file</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">());</span>
                <span class="n">image</span><span class="o">.</span><span class="na">setAlignment</span><span class="o">(</span><span class="nc">Image</span><span class="o">.</span><span class="na">ALIGN_CENTER</span><span class="o">);</span>
                <span class="n">cell</span><span class="o">.</span><span class="na">setImage</span><span class="o">(</span><span class="n">image</span><span class="o">);</span>
                <span class="n">table</span><span class="o">.</span><span class="na">addCell</span><span class="o">(</span><span class="n">cell</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">paragraph</span><span class="o">);</span>
            <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">anchor</span><span class="o">);</span>
            <span class="n">document</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">table</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"文件不存在!!"</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>

    <span class="cm">/**
     * 创建单元格(指定字体)
     *
     * @param value
     * @param font
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">PdfPCell</span> <span class="nf">createCell</span><span class="o">(</span><span class="nc">String</span> <span class="n">value</span><span class="o">,</span> <span class="nc">Font</span> <span class="n">font</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">PdfPCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfPCell</span><span class="o">();</span>
        <span class="n">cell</span><span class="o">.</span><span class="na">setVerticalAlignment</span><span class="o">(</span><span class="nc">Element</span><span class="o">.</span><span class="na">ALIGN_MIDDLE</span><span class="o">);</span>
        <span class="n">cell</span><span class="o">.</span><span class="na">setHorizontalAlignment</span><span class="o">(</span><span class="nc">Element</span><span class="o">.</span><span class="na">ALIGN_CENTER</span><span class="o">);</span>
        <span class="n">cell</span><span class="o">.</span><span class="na">setPhrase</span><span class="o">(</span><span class="k">new</span> <span class="nc">Phrase</span><span class="o">(</span><span class="n">value</span><span class="o">,</span> <span class="n">font</span><span class="o">));</span>
        <span class="k">return</span> <span class="n">cell</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 创建指定列宽、列数的表格
     *
     * @param widths
     * @return
     */</span>
    <span class="kd">public</span> <span class="nc">PdfPTable</span> <span class="nf">createTable</span><span class="o">(</span><span class="kt">float</span><span class="o">[]</span> <span class="n">widths</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">PdfPTable</span> <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfPTable</span><span class="o">(</span><span class="n">widths</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">table</span><span class="o">.</span><span class="na">setTotalWidth</span><span class="o">(</span><span class="n">maxWidth</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">setLockedWidth</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">setHorizontalAlignment</span><span class="o">(</span><span class="nc">Element</span><span class="o">.</span><span class="na">ALIGN_CENTER</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">getDefaultCell</span><span class="o">().</span><span class="na">setBorder</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="n">table</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>




</code></pre></div></div> <h2 id="调用并下载功能">调用并下载功能</h2> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">generatePdf</span><span class="o">(</span><span class="nc">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span> <span class="nc">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nc">File</span> <span class="n">imagePath</span><span class="o">,</span> <span class="nc">File</span> <span class="n">pdfPath</span><span class="o">,</span> <span class="nc">File</span> <span class="n">fontPath</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">date</span> <span class="o">=</span> <span class="nc">DateUtil</span><span class="o">.</span><span class="na">getDate</span><span class="o">(</span><span class="s">"yyyyMMddHHmmss"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="s">"文件名称"</span> <span class="o">+</span> <span class="n">date</span> <span class="o">+</span> <span class="s">".pdf"</span><span class="o">;</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="nc">Document</span> <span class="n">document</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Document</span><span class="o">(</span><span class="nc">PageSize</span><span class="o">.</span><span class="na">A4</span><span class="o">);</span>
            <span class="nc">File</span> <span class="n">file</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">pdfPath</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">().</span><span class="na">replace</span><span class="o">(</span><span class="s">"\\"</span><span class="o">,</span> <span class="s">"/"</span><span class="o">)</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="s">"文件名称.pdf"</span><span class="o">);</span>
            <span class="n">file</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
            <span class="nc">PdfWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="nc">PdfWriter</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">document</span><span class="o">,</span> <span class="k">new</span> <span class="nc">FileOutputStream</span><span class="o">(</span><span class="n">file</span><span class="o">));</span>
            <span class="n">writer</span><span class="o">.</span><span class="na">setPageEvent</span><span class="o">(</span><span class="k">new</span> <span class="nc">Watermark</span><span class="o">(</span><span class="s">"slience_me"</span><span class="o">));</span><span class="c1">// 水印</span>
            <span class="n">writer</span><span class="o">.</span><span class="na">setPageEvent</span><span class="o">(</span><span class="k">new</span> <span class="nc">MyHeaderFooter</span><span class="o">(</span><span class="n">fontPath</span><span class="o">));</span><span class="c1">// 页眉/页脚</span>
            <span class="n">document</span><span class="o">.</span><span class="na">open</span><span class="o">();</span>
            <span class="n">document</span><span class="o">.</span><span class="na">addTitle</span><span class="o">(</span><span class="s">"QRCode导出文件"</span><span class="o">);</span><span class="c1">// 标题</span>
            <span class="n">document</span><span class="o">.</span><span class="na">addAuthor</span><span class="o">(</span><span class="s">"slience_me"</span><span class="o">);</span><span class="c1">// 作者</span>
            <span class="n">document</span><span class="o">.</span><span class="na">addSubject</span><span class="o">(</span><span class="s">"QRCode导出文件"</span><span class="o">);</span><span class="c1">// 主题</span>
            <span class="n">document</span><span class="o">.</span><span class="na">addKeywords</span><span class="o">(</span><span class="s">"QRCode导出文件"</span><span class="o">);</span><span class="c1">// 关键字</span>
            <span class="n">document</span><span class="o">.</span><span class="na">addCreator</span><span class="o">(</span><span class="s">"slience_me"</span><span class="o">);</span><span class="c1">// 创建者</span>
            <span class="nc">PdfReport</span> <span class="n">pdfReport</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfReport</span><span class="o">();</span>
            <span class="n">pdfReport</span><span class="o">.</span><span class="na">generateQRCodePDF</span><span class="o">(</span><span class="n">document</span><span class="o">,</span> <span class="n">imagePath</span><span class="o">,</span> <span class="n">fontPath</span><span class="o">);</span>
            <span class="n">document</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="nc">FileInputStream</span> <span class="n">fileInputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">FileInputStream</span><span class="o">(</span><span class="n">file</span><span class="o">);</span>
            <span class="nc">InputStream</span> <span class="n">fis</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedInputStream</span><span class="o">(</span><span class="n">fileInputStream</span><span class="o">);</span>
            <span class="kt">byte</span><span class="o">[]</span> <span class="n">buffer</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">byte</span><span class="o">[</span><span class="n">fis</span><span class="o">.</span><span class="na">available</span><span class="o">()];</span>
            <span class="n">fis</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
            <span class="n">fis</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="n">response</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setCharacterEncoding</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
            <span class="c1">//Content-Disposition的作用：告知浏览器以何种方式显示响应返回的文件，用浏览器打开还是以附件的形式下载到本地保存</span>
            <span class="c1">//attachment表示以附件方式下载 inline表示在线打开 "Content-Disposition: inline; filename=文件名.mp3"</span>
            <span class="c1">// filename表示文件的默认名称，因为网络传输只支持URL编码的相关支付，因此需要将文件名URL编码后进行传输,前端收到后需要反编码才能获取到真正的名称</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment;filename="</span> <span class="o">+</span> <span class="nc">URLEncoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="s">"UTF-8"</span><span class="o">));</span>
            <span class="c1">// 告知浏览器文件的大小</span>
            <span class="n">response</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"Content-Length"</span><span class="o">,</span> <span class="s">""</span> <span class="o">+</span> <span class="n">file</span><span class="o">.</span><span class="na">length</span><span class="o">());</span>
            <span class="nc">OutputStream</span> <span class="n">outputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BufferedOutputStream</span><span class="o">(</span><span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">());</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/octet-stream"</span><span class="o">);</span>
            <span class="n">outputStream</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">buffer</span><span class="o">);</span>
            <span class="n">outputStream</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
            <span class="n">outputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>

    <span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @title Watermark
 * @description wms-parent
 * @author slience_me
 * @version 1.0.0
 * @since 2023/1/13 14:10
 */</span>
<span class="kn">package</span> <span class="nn">xyz.slienceme.utils.pdf</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.Document</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.Element</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.Font</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.Phrase</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.ColumnText</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.GrayColor</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.PdfPageEventHelper</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.PdfWriter</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Watermark</span> <span class="kd">extends</span> <span class="nc">PdfPageEventHelper</span> <span class="o">{</span>
    <span class="nc">Font</span> <span class="no">FONT</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Font</span><span class="o">(</span><span class="nc">Font</span><span class="o">.</span><span class="na">FontFamily</span><span class="o">.</span><span class="na">HELVETICA</span><span class="o">,</span> <span class="mi">30</span><span class="o">,</span> <span class="nc">Font</span><span class="o">.</span><span class="na">BOLD</span><span class="o">,</span> <span class="k">new</span> <span class="nc">GrayColor</span><span class="o">(</span><span class="mf">0.95f</span><span class="o">));</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">waterCont</span><span class="o">;</span><span class="c1">//水印内容</span>

    <span class="kd">public</span> <span class="nf">Watermark</span><span class="o">(</span><span class="nc">String</span> <span class="n">waterCont</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">waterCont</span> <span class="o">=</span> <span class="n">waterCont</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEndPage</span><span class="o">(</span><span class="nc">PdfWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="nc">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
                <span class="nc">ColumnText</span><span class="o">.</span><span class="na">showTextAligned</span><span class="o">(</span><span class="n">writer</span><span class="o">.</span><span class="na">getDirectContentUnder</span><span class="o">(),</span>
                        <span class="nc">Element</span><span class="o">.</span><span class="na">ALIGN_CENTER</span><span class="o">,</span>
                        <span class="k">new</span> <span class="nf">Phrase</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">waterCont</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="s">"HELLO WORLD"</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">waterCont</span><span class="o">,</span> <span class="no">FONT</span><span class="o">),</span>
                        <span class="o">(</span><span class="mf">50.5f</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">350</span><span class="o">),</span>
                        <span class="o">(</span><span class="mf">40.0f</span> <span class="o">+</span> <span class="n">j</span> <span class="o">*</span> <span class="mi">150</span><span class="o">),</span>
                        <span class="n">writer</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">()</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="mi">45</span> <span class="o">:</span> <span class="o">-</span><span class="mi">45</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * @title MyHeaderFooter
 * @description wms-parent
 * @author slience_me
 * @version 1.0.0
 * @since 2023/1/13 14:10
 */</span>
<span class="kn">package</span> <span class="nn">xyz.slienceme.utils.pdf</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.itextpdf.text.pdf.*</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.File</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyHeaderFooter</span> <span class="kd">extends</span> <span class="nc">PdfPageEventHelper</span> <span class="o">{</span>
    <span class="c1">// 总页数</span>
    <span class="nc">PdfTemplate</span> <span class="n">totalPage</span><span class="o">;</span>
    <span class="nc">Font</span> <span class="n">hfFont</span><span class="o">;</span>
    <span class="kd">public</span> <span class="nf">MyHeaderFooter</span><span class="o">(</span><span class="nc">File</span> <span class="n">fontPath</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">filename</span> <span class="o">=</span> <span class="s">"SimHei.ttf"</span><span class="o">;</span>
        <span class="nc">File</span> <span class="n">fontFile</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">File</span><span class="o">(</span><span class="n">fontPath</span><span class="o">,</span> <span class="n">filename</span><span class="o">);</span>
        <span class="n">hfFont</span> <span class="o">=</span> <span class="nc">FontFactory</span><span class="o">.</span><span class="na">getFont</span><span class="o">(</span><span class="n">fontFile</span><span class="o">.</span><span class="na">getAbsolutePath</span><span class="o">(),</span> <span class="nc">BaseFont</span><span class="o">.</span><span class="na">IDENTITY_H</span><span class="o">,</span> <span class="nc">BaseFont</span><span class="o">.</span><span class="na">NOT_EMBEDDED</span><span class="o">,</span><span class="mi">10</span><span class="n">f</span><span class="o">,</span> <span class="nc">Font</span><span class="o">.</span><span class="na">NORMAL</span><span class="o">,</span> <span class="nc">BaseColor</span><span class="o">.</span><span class="na">BLACK</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// 打开文档时，创建一个总页数的模版</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onOpenDocument</span><span class="o">(</span><span class="nc">PdfWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="nc">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">PdfContentByte</span> <span class="n">cb</span> <span class="o">=</span> <span class="n">writer</span><span class="o">.</span><span class="na">getDirectContent</span><span class="o">();</span>
        <span class="n">totalPage</span> <span class="o">=</span> <span class="n">cb</span><span class="o">.</span><span class="na">createTemplate</span><span class="o">(</span><span class="mi">30</span><span class="o">,</span> <span class="mi">16</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// 一页加载完成触发，写入页眉和页脚</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onEndPage</span><span class="o">(</span><span class="nc">PdfWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="nc">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">PdfPTable</span> <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfPTable</span><span class="o">(</span><span class="mi">3</span><span class="o">);</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">table</span><span class="o">.</span><span class="na">setTotalWidth</span><span class="o">(</span><span class="nc">PageSize</span><span class="o">.</span><span class="na">A4</span><span class="o">.</span><span class="na">getWidth</span><span class="o">()</span> <span class="o">-</span> <span class="mi">100</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">setWidths</span><span class="o">(</span><span class="k">new</span> <span class="kt">int</span><span class="o">[]{</span><span class="mi">24</span><span class="o">,</span> <span class="mi">24</span><span class="o">,</span> <span class="mi">3</span><span class="o">});</span>
            <span class="n">table</span><span class="o">.</span><span class="na">setLockedWidth</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">getDefaultCell</span><span class="o">().</span><span class="na">setFixedHeight</span><span class="o">(-</span><span class="mi">10</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">getDefaultCell</span><span class="o">().</span><span class="na">setBorder</span><span class="o">(</span><span class="nc">Rectangle</span><span class="o">.</span><span class="na">BOTTOM</span><span class="o">);</span>

            <span class="n">table</span><span class="o">.</span><span class="na">addCell</span><span class="o">(</span><span class="k">new</span> <span class="nc">Paragraph</span><span class="o">(</span><span class="s">"大标题"</span><span class="o">,</span> <span class="n">hfFont</span><span class="o">));</span><span class="c1">// 可以直接使用addCell(str)，不过不能指定字体，中文无法显示</span>
            <span class="n">table</span><span class="o">.</span><span class="na">getDefaultCell</span><span class="o">().</span><span class="na">setHorizontalAlignment</span><span class="o">(</span><span class="nc">Element</span><span class="o">.</span><span class="na">ALIGN_RIGHT</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">addCell</span><span class="o">(</span><span class="k">new</span> <span class="nc">Paragraph</span><span class="o">(</span><span class="s">"第"</span> <span class="o">+</span> <span class="n">writer</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">()</span> <span class="o">+</span> <span class="s">"页/"</span><span class="o">,</span> <span class="n">hfFont</span><span class="o">));</span>
            <span class="c1">// 总页数</span>
            <span class="nc">PdfPCell</span> <span class="n">cell</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">PdfPCell</span><span class="o">(</span><span class="nc">Image</span><span class="o">.</span><span class="na">getInstance</span><span class="o">(</span><span class="n">totalPage</span><span class="o">));</span>
            <span class="n">cell</span><span class="o">.</span><span class="na">setBorder</span><span class="o">(</span><span class="nc">Rectangle</span><span class="o">.</span><span class="na">BOTTOM</span><span class="o">);</span>
            <span class="n">table</span><span class="o">.</span><span class="na">addCell</span><span class="o">(</span><span class="n">cell</span><span class="o">);</span>
            <span class="c1">// 将页眉写到document中，位置可以指定，指定到下面就是页脚</span>
            <span class="n">table</span><span class="o">.</span><span class="na">writeSelectedRows</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">50</span><span class="o">,</span> <span class="nc">PageSize</span><span class="o">.</span><span class="na">A4</span><span class="o">.</span><span class="na">getHeight</span><span class="o">()</span> <span class="o">-</span> <span class="mi">20</span><span class="o">,</span> <span class="n">writer</span><span class="o">.</span><span class="na">getDirectContent</span><span class="o">());</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Exception</span> <span class="n">de</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">ExceptionConverter</span><span class="o">(</span><span class="n">de</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="c1">// 全部完成后，将总页数的pdf模版写到指定位置</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCloseDocument</span><span class="o">(</span><span class="nc">PdfWriter</span> <span class="n">writer</span><span class="o">,</span> <span class="nc">Document</span> <span class="n">document</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">String</span> <span class="n">text</span> <span class="o">=</span> <span class="s">"总"</span> <span class="o">+</span> <span class="o">(</span><span class="n">writer</span><span class="o">.</span><span class="na">getPageNumber</span><span class="o">())</span> <span class="o">+</span> <span class="s">"页"</span><span class="o">;</span>
        <span class="nc">ColumnText</span><span class="o">.</span><span class="na">showTextAligned</span><span class="o">(</span><span class="n">totalPage</span><span class="o">,</span> <span class="nc">Element</span><span class="o">.</span><span class="na">ALIGN_LEFT</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Paragraph</span><span class="o">(</span><span class="n">text</span><span class="o">,</span> <span class="n">hfFont</span><span class="o">),</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

<span class="o">}</span>
</code></pre></div></div> <h2 id="导出效果">导出效果</h2> <p><img src="https://slienceme.cn/images/posts/37343e08fd014d6282c18508712023ca.png" alt="Alt Text" /></p> <h2 id="其他问题">其他问题</h2> <p><a href="https://blog.csdn.net/Slience_me/article/details/128689799">springboot生成QRcode二维码【上下带有文字备注】【2023年1月14日】</a></p> <p><a href="https://blog.csdn.net/Slience_me/article/details/128689953">【springboot】linux系统部署后Font文字不存在【Java Font 自定义字体】【2023年1月14日】</a></p> <div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"> <h3>文档信息</h3> <ul> <li>本文作者：<a href="https://slienceme.cn" target="_blank">slience_me</a></li> <li>本文链接：<a href="https://slienceme.cn/2023/01/14/%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90QRCode%E4%BA%8C%E7%BB%B4%E7%A0%81PDF%E6%96%87%E4%BB%B6/" target="_blank">https://slienceme.cn/2023/01/14/%E6%89%B9%E9%87%8F%E7%94%9F%E6%88%90QRCode%E4%BA%8C%E7%BB%B4%E7%A0%81PDF%E6%96%87%E4%BB%B6/</a></li> <li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li> </ul> </div> </article> <div class="share"> <div class="share-component" data-disabled='qq,facebook'></div> </div> <div class="comment"> <script src="https://giscus.app/client.js" data-repo="slience-me/blog-comments" data-repo-id="MDEwOlJlcG9zaXRvcnk5MzEyNzkxNw==" data-category="Announcements" data-category-id="DIC_kwDOBY0E7c4CRtg9" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async> </script> </div> </div> <div class="column one-fourth"> <h3>Search</h3> <div id="site_search"> <input style="width:96%" type="text" id="search_box" placeholder="Search"> </div> <ul id="search_results" style="font-size:14px;list-style-type:none;padding-top:10px;padding-left:10px;"></ul> <script src="https://slienceme.cn/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://slienceme.cn/assets/search_data.json?v=1736474771', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: 10, fuzzy: false, exclude: ['Welcome'] }) </script> <h3 class="post-directory-title mobile-hidden">Table of Contents</h3> <div id="post-directory-module" class="mobile-hidden"> <section class="post-directory"> <dl></dl> </section> </div> <script src="https://slienceme.cn/assets/js/jquery.toc.js"></script> </div> </div> </section> <footer class="container"> <div class="site-footer" role="contentinfo"> <div class="copyright left mobile-block"> Copyright@ 2019-2025 slience_me 版权所有&emsp; <img src="/images/logo/logo.png" class="w-full" style="width: 12px;"> <a href="https://beian.mps.gov.cn/#/query/webSearch?code=13102202000626" rel="noreferrer" target="_blank">冀公网安备13102202000626</a>&emsp; <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" rel="noreferrer">津ICP备2024026565号-1</a> <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a> </div> <ul class="site-footer-links right mobile-hidden"> <li> <a href="javascript:window.scrollTo(0,0)" >TOP</a> </li> </ul> <br/> <script async src="https://slienceme.cn/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script> <div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2024-12-01 </span> </div> </div> </footer> <div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a> </div> <script src="https://slienceme.cn/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://slienceme.cn/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script> </body> </html>
