<!DOCTYPE html> <html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /> <title>服务器｜【指令集】Nginx &mdash; Slience_me的博客</title> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/primer-css/css/primer.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/collection.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/repo-card.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/sections/repo-list.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/components/boxed-group.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/common.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/globals/responsive.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/css/posts/index.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/octicons/octicons/octicons.css"> <link rel="stylesheet" href=" https://cdn.jsdelivr.net/npm/@docsearch/css@3 "/> <link rel="stylesheet" href="https://mazhuang.org/rouge-themes/dist/github.css"> <link rel="stylesheet" href="https://blog.slienceme.cn/assets/vendor/share.js/dist/css/share.min.css"> <link rel="canonical" href="https://blog.slienceme.cn/2025/02/15/Nginx%E6%93%8D%E4%BD%9C%E5%90%88%E9%9B%86/"> <link rel="alternate" type="application/atom+xml" title="Slience_me的博客" href="https://blog.slienceme.cn/feed.xml"> <link rel="shortcut icon" href="https://blog.slienceme.cn/favicon.ico"> <meta property="og:title" content="服务器｜【指令集】Nginx"> <meta name="keywords" content="指令汇总, 服务器, Nginx"> <meta name="og:keywords" content="指令汇总, 服务器, Nginx"> <meta name="description" content=""> <meta name="og:description" content=""> <meta property="og:url" content="https://blog.slienceme.cn/2025/02/15/Nginx%E6%93%8D%E4%BD%9C%E5%90%88%E9%9B%86/"> <meta property="og:site_name" content="Slience_me的博客"> <meta property="og:type" content="article"> <meta property="og:locale" content="zh_CN" /> <meta property="article:published_time" content="2025-02-15"> <meta name="google-site-verification" content="2feHjT1GNs1Yi2JQfOtdYx7d048naG_-cMwZaDAopIA" /> <script src="https://blog.slienceme.cn/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/main.js"></script> </head> <body class="" data-mz=""> <header class="site-header"> <div class="container"> <h1><a href="https://blog.slienceme.cn/" title="Slience_me的博客"><span class="octicon octicon-mark-github"></span> Slience_me的博客</a></h1> <button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button> <nav class="site-header-nav" role="navigation"> <a href="https://blog.slienceme.cn/" class="site-header-nav-item" target="" title="首页">首页</a> <a href="https://blog.slienceme.cn/categories/" class="site-header-nav-item" target="" title="分类">分类</a> <a href="https://blog.slienceme.cn/archives/" class="mobile-hidden site-header-nav-item" target="" title="归档">归档</a> <a href="https://blog.slienceme.cn/open-source/" class="mobile-hidden site-header-nav-item" target="" title="开源">开源</a> <a href="https://blog.slienceme.cn/fragments/" class="site-header-nav-item" target="" title="片段">片段</a> <a href="https://blog.slienceme.cn/wiki/" class="site-header-nav-item" target="" title="维基">维基</a> <a href="https://blog.slienceme.cn/links/" class="mobile-hidden site-header-nav-item" target="" title="链接">链接</a> <a href="https://blog.slienceme.cn/about/" class="site-header-nav-item" target="" title="关于">关于</a> <a class="mobile-hidden" href="https://blog.slienceme.cn/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a> </nav> </div> </header> <section class="collection-head small geopattern" data-pattern-id="服务器｜【指令集】Nginx"> <div class="container"> <div class="columns"> <div class="column three-fourths"> <div class="collection-title"> <h1 class="collection-header">服务器｜【指令集】Nginx</h1> <div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2025/02/15 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://blog.slienceme.cn/categories/#指令汇总" title="指令汇总">指令汇总</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://blog.slienceme.cn/categories/#服务器" title="服务器">服务器</a> </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://blog.slienceme.cn/categories/#Linux" title="Linux">Linux</a> </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 7688 字，约 22 分钟 </span> </div> </div> </div> <div class="column one-fourth mobile-hidden"> <div class="collection-title"> </div> </div> </div> </div> </section> <section class="container content"> <div class="columns"> <div class="column three-fourths" > <article class="article-content markdown-body"> <p><img src="https://blog.slienceme.cn/images/posts/logo_slienceme3.png" alt="img" /></p> <p>本文作者： <a href="https://slienceme.cn/">slience_me</a></p> <hr /> <h1 id="指令集nginx">【指令集】Nginx</h1> <hr /> <h2 id="1-目录结构">1. 目录结构</h2> <p>Nginx 的基础目录结构通常包括以下几个主要目录：</p> <p>Nginx的目录结构大致如下（以Linux系统为例）：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/nginx/                 # Nginx的配置文件目录
├── nginx.conf              # 主配置文件
├── conf.d/                 # 包含额外配置文件的目录
│   └── default.conf        # 默认虚拟主机配置文件
├── sites-available/        # 存放可用站点的配置文件（某些系统上可能没有此目录）
├── sites-enabled/          # 启用的站点配置文件（某些系统上可能没有此目录）
├── mime.types              # MIME类型配置文件
├── fastcgi_params          # FastCGI参数配置
├── uwsgi_params            # uWSGI参数配置
└── scgi_params             # SCGI参数配置

/usr/local/nginx/           # Nginx的默认安装目录
├── sbin/                   # 可执行文件目录（包含nginx二进制文件）
│   └── nginx               # Nginx主程序
├── html/                   # 默认的网页根目录
│   └── index.html          # 默认的欢迎页面
├── logs/                   # 日志目录
│   ├── access.log          # 访问日志
│   └── error.log           # 错误日志
└── conf/                   # 配置文件目录（有时可以与/etc/nginx合并）
</code></pre></div></div> <h3 id="主要目录和文件">主要目录和文件：</h3> <ul> <li><code class="language-plaintext highlighter-rouge">/etc/nginx/nginx.conf</code>：主配置文件，控制Nginx的全局设置。</li> <li><code class="language-plaintext highlighter-rouge">/etc/nginx/conf.d/</code>：通常存放额外的虚拟主机配置文件，可以分配单独的文件来管理不同站点的配置。</li> <li><code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/</code> 和 <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code>：用于存储和启用站点的配置文件，常见于Ubuntu/Debian系统。<code class="language-plaintext highlighter-rouge">sites-available</code>存放所有配置文件，而<code class="language-plaintext highlighter-rouge">sites-enabled</code>存放实际启用的配置链接。</li> <li><code class="language-plaintext highlighter-rouge">/usr/local/nginx/html/</code>：默认的网页文件目录，可以存放网站的静态文件，如HTML、CSS和JavaScript等。</li> <li><code class="language-plaintext highlighter-rouge">/usr/local/nginx/logs/</code>：存放Nginx的日志文件，通常包括访问日志和错误日志。</li> </ul> <p>你可以根据自己的实际需求定制这些目录和配置文件。</p> <h2 id="2-系统级安装">2. 系统级安装</h2> <h3 id="ubuntu">【Ubuntu】</h3> <h4 id="1更新索引">1）更新索引</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
</code></pre></div></div> <h4 id="2安装-nginx">2）安装 Nginx</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>nginx
</code></pre></div></div> <p>安装完成后，Nginx 会自动启动。如果没有启动，可以手动启动它：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl start nginx
</code></pre></div></div> <p>检查 Nginx 的状态：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl status nginx
</code></pre></div></div> <h4 id="3查找-nginx-配置文件">3）查找 Nginx 配置文件</h4> <p>Nginx 配置文件通常位于以下几个位置：</p> <ul> <li>主配置文件：<code class="language-plaintext highlighter-rouge">/etc/nginx/nginx.conf</code></li> <li>默认虚拟主机配置：<code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/default</code></li> <li>虚拟主机配置目录：<code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/</code> 和 <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code></li> <li>日志文件： <ul> <li>访问日志：<code class="language-plaintext highlighter-rouge">/var/log/nginx/access.log</code></li> <li>错误日志：<code class="language-plaintext highlighter-rouge">/var/log/nginx/error.log</code></li> </ul> </li> </ul> <p>查看主配置文件：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/nginx/nginx.conf
</code></pre></div></div> <p>查看虚拟主机配置：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/nginx/sites-available/default
</code></pre></div></div> <p>如果你有多个网站需要配置，可以创建新的配置文件，并通过符号链接激活它：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/your-site.conf /etc/nginx/sites-enabled/
</code></pre></div></div> <h4 id="4测试配置文件的语法">4）测试配置文件的语法</h4> <p>每次修改配置文件后，先检查 Nginx 配置文件的语法是否正确：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nginx <span class="nt">-t</span>
</code></pre></div></div> <p>如果没有错误，输出应该是：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nginx: configuration file /etc/nginx/nginx.conf <span class="nb">test </span>is successful
</code></pre></div></div> <h4 id="5重新加载-nginx-配置">5）重新加载 Nginx 配置</h4> <p>在确认配置文件没有语法错误后，重新加载 Nginx，使配置生效：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl reload nginx
</code></pre></div></div> <h4 id="6常见配置修改">6）常见配置修改</h4> <ul> <li>设置服务器根目录：</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
    listen 80<span class="p">;</span>
    server_name example.com<span class="p">;</span>
    root /var/www/html<span class="p">;</span>
    index index.html<span class="p">;</span>

    location / <span class="o">{</span>
        try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ <span class="o">=</span>404<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li>修改监听端口：</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
    listen 8080<span class="p">;</span>
    server_name example.com<span class="p">;</span>
    root /var/www/html<span class="p">;</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li>配置反向代理：</li> </ul> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
    listen 80<span class="p">;</span>
    server_name example.com<span class="p">;</span>

    location / <span class="o">{</span>
        proxy_pass http://localhost:3000<span class="p">;</span>
        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
        proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
        proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
        proxy_set_header X-Forwarded-Proto <span class="nv">$scheme</span><span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h4 id="7设置防火墙">7）设置防火墙</h4> <p><strong>允许 HTTP 和 HTTPS 流量</strong></p> <p>如果你正在使用 <code class="language-plaintext highlighter-rouge">ufw</code> 防火墙，确保允许 HTTP 和 HTTPS 流量：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw allow <span class="s1">'Nginx Full'</span>
</code></pre></div></div> <h4 id="8运行检查">8）运行检查</h4> <p><strong>Nginx 是否正常运行</strong></p> <p>通过浏览器访问服务器的 IP 地址或域名，应该能看到 Nginx 默认的欢迎页面：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://your_server_ip
</code></pre></div></div> <p>如果看到页面，说明 Nginx 正常运行。</p> <h2 id="3-个性化操作">3. 个性化操作</h2> <h3 id="31-自定义站点路径">3.1 自定义站点路径</h3> <p>要自定义不同站点的配置文件路径，并将其放在用户目录或根目录下（例如 <code class="language-plaintext highlighter-rouge">/mysite/</code>），而不是直接操作 <code class="language-plaintext highlighter-rouge">/etc/nginx/</code> 或 <code class="language-plaintext highlighter-rouge">/usr/local/nginx/</code>，你可以通过以下步骤来实现：</p> <h4 id="1修改-nginx-配置文件">1）修改 Nginx 配置文件</h4> <p>你需要调整 Nginx 主配置文件 <code class="language-plaintext highlighter-rouge">nginx.conf</code> 来指定新的配置文件路径。具体来说，在 <code class="language-plaintext highlighter-rouge">http</code> 块中使用 <code class="language-plaintext highlighter-rouge">include</code> 指令来加载你的自定义路径下的配置文件。</p> <p>假设你希望将站点配置文件存放在 <code class="language-plaintext highlighter-rouge">/mysite/nginx-sites/</code>，那么在 <code class="language-plaintext highlighter-rouge">nginx.conf</code> 中添加如下内容：</p> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">http</span> <span class="p">{</span>
    <span class="kn">...</span>
    <span class="s">include</span> <span class="n">/mysite/nginx-sites/*.conf</span><span class="p">;</span>
    <span class="kn">...</span>
<span class="err">}</span>
</code></pre></div></div> <p>这会告诉 Nginx 在启动时加载 <code class="language-plaintext highlighter-rouge">/mysite/nginx-sites/</code> 目录下所有 <code class="language-plaintext highlighter-rouge">.conf</code> 后缀的配置文件。</p> <h4 id="2创建并管理自定义站点配置">2）创建并管理自定义站点配置</h4> <p>在 <code class="language-plaintext highlighter-rouge">/mysite/nginx-sites/</code> 目录下创建每个站点的配置文件。例如：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mysite/nginx-sites/
├── site1.conf
├── site2.conf
└── site3.conf
</code></pre></div></div> <p>每个 <code class="language-plaintext highlighter-rouge">.conf</code> 文件中可以包含你要为特定站点设置的 Nginx 配置，比如 <code class="language-plaintext highlighter-rouge">server</code> 块和其他必要的指令。</p> <p>例如，<code class="language-plaintext highlighter-rouge">site1.conf</code> 可能是这样的：</p> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">www.site1.com</span><span class="p">;</span>
    <span class="kn">root</span> <span class="n">/mysite/www/site1</span><span class="p">;</span>
    
    <span class="kn">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div> <h4 id="3设置权限可选">3）设置权限（可选）</h4> <p>确保 <code class="language-plaintext highlighter-rouge">/mysite/nginx-sites/</code> 目录及其中的配置文件有适当的权限，以确保 Nginx 进程能够读取它们。例如：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo chown</span> <span class="nt">-R</span> nginx:nginx /mysite/nginx-sites/
<span class="nb">sudo chmod</span> <span class="nt">-R</span> 755 /mysite/nginx-sites/
</code></pre></div></div> <h4 id="4配置文件组织可选">4）配置文件组织（可选）</h4> <p>你可以进一步组织你的配置文件，如使用 <code class="language-plaintext highlighter-rouge">sites-available</code> 和 <code class="language-plaintext highlighter-rouge">sites-enabled</code> 目录结构：</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/mysite/nginx-sites/
├── sites-available/
│   ├── site1.conf
│   └── site2.conf
└── sites-enabled/
    ├── site1.conf -&gt; ../sites-available/site1.conf
    └── site2.conf -&gt; ../sites-available/site2.conf
    
ln -s /mysite/nginx-sites/sites-available/site1.conf /mysite/nginx-sites/sites-enabled/
</code></pre></div></div> <p>然后在 <code class="language-plaintext highlighter-rouge">nginx.conf</code> 中改为加载 <code class="language-plaintext highlighter-rouge">sites-enabled</code> 目录中的配置：</p> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">http</span> <span class="p">{</span>
    <span class="kn">...</span>
    <span class="s">include</span> <span class="n">/mysite/nginx-sites/sites-enabled/*.conf</span><span class="p">;</span>
    <span class="kn">...</span>
<span class="err">}</span>
</code></pre></div></div> <p>这种方式与传统的 <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-available/</code> 和 <code class="language-plaintext highlighter-rouge">/etc/nginx/sites-enabled/</code> 方法类似。</p> <h4 id="5重启-nginx-使配置生效">5）重启 Nginx 使配置生效</h4> <p>完成修改后，记得重新加载或重启 Nginx：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nginx <span class="nt">-t</span>       <span class="c"># 检查配置是否有误</span>
<span class="nb">sudo </span>systemctl reload nginx   <span class="c"># 重新加载配置</span>
</code></pre></div></div> <h2 id="4-用户级安装">4. 用户级安装</h2> <p>如果你没有系统级安装 Nginx 的权限，但仍然希望在用户目录中运行自定义的 Nginx 实例，你可以通过以下步骤来实现：</p> <h3 id="41-在用户目录安装-nginx">4.1 在用户目录安装 Nginx</h3> <p>首先，你可以在用户目录下手动下载并编译 Nginx，确保你有权限在自己的用户目录中进行安装和配置。</p> <p><strong>步骤：</strong></p> <ol> <li> <p><strong>下载 Nginx 源代码</strong>：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget http://nginx.org/download/nginx-1.24.0.tar.gz
<span class="nb">tar</span> <span class="nt">-zxvf</span> nginx-1.24.0.tar.gz
<span class="nb">cd </span>nginx-1.24.0
</code></pre></div> </div> </li> <li> <p><strong>编译并安装到用户目录</strong>： 你可以指定安装路径为你的用户目录（例如 <code class="language-plaintext highlighter-rouge">~/nginx</code>）：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./configure <span class="nt">--prefix</span><span class="o">=</span><span class="nv">$HOME</span>/nginx
make
make <span class="nb">install</span>
</code></pre></div> </div> </li> <li> <p><strong>安装完成后</strong>，你将在 <code class="language-plaintext highlighter-rouge">~/nginx/</code> 目录下找到所有相关的文件和目录。此时，你可以直接在 <code class="language-plaintext highlighter-rouge">~/nginx/</code> 下运行 Nginx，而无需系统级的权限。</p> </li> </ol> <h3 id="42-配置-nginx-使用自定义的站点路径">4.2 配置 Nginx 使用自定义的站点路径</h3> <p>假设你已经在 <code class="language-plaintext highlighter-rouge">~/nginx</code> 目录下安装了 Nginx，现在你可以按照自定义路径来配置你的站点。</p> <p><strong>修改 Nginx 配置文件：</strong></p> <p>Nginx 的配置文件通常位于 <code class="language-plaintext highlighter-rouge">~/nginx/conf/nginx.conf</code>。你可以打开这个文件，并根据你的需求进行修改：</p> <ol> <li> <p><strong>修改站点配置路径</strong>：例如，将站点配置文件放在 <code class="language-plaintext highlighter-rouge">~/mysite/nginx-sites/</code> 目录下，并在 <code class="language-plaintext highlighter-rouge">nginx.conf</code> 中使用 <code class="language-plaintext highlighter-rouge">include</code> 指令来加载它们：</p> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">http</span> <span class="p">{</span>
    <span class="kn">...</span>
    <span class="s">include</span> <span class="p">~</span><span class="sr">/mysite/nginx-sites/*.conf;</span>
    <span class="s">...</span>
<span class="err">}</span>
</code></pre></div> </div> </li> <li> <p><strong>配置站点文件</strong>：在 <code class="language-plaintext highlighter-rouge">~/mysite/nginx-sites/</code> 目录下创建站点配置文件。例如，<code class="language-plaintext highlighter-rouge">site1.conf</code>：</p> <div class="language-nginx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span> <span class="s">www.site1.com</span><span class="p">;</span>
    <span class="kn">root</span> <span class="p">~</span><span class="sr">/mysite/www/site1;</span>
       
    <span class="s">location</span> <span class="n">/</span> <span class="p">{</span>
        <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="nv">$uri</span><span class="n">/</span> <span class="p">=</span><span class="mi">404</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div> </div> </li> <li> <p><strong>确保站点根目录存在并配置好</strong>，比如 <code class="language-plaintext highlighter-rouge">~/mysite/www/site1</code> 目录。</p> </li> </ol> <h3 id="43-启动-nginx">4.3 启动 Nginx</h3> <p>由于你没有系统级的权限，使用自定义安装的 Nginx 来启动和管理 Nginx 服务：</p> <ol> <li> <p><strong>启动 Nginx</strong>：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/nginx/sbin/nginx
</code></pre></div> </div> </li> <li> <p><strong>检查 Nginx 状态</strong>： 你可以使用 <code class="language-plaintext highlighter-rouge">ps</code> 或 <code class="language-plaintext highlighter-rouge">top</code> 来确认 Nginx 是否正在运行：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ps aux | <span class="nb">grep </span>nginx
</code></pre></div> </div> </li> <li> <p><strong>停止 Nginx</strong>： 如果需要停止 Nginx，可以使用以下命令：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/nginx/sbin/nginx <span class="nt">-s</span> stop
</code></pre></div> </div> </li> <li> <p><strong>重新加载配置</strong>： 如果修改了配置文件，需要重新加载 Nginx：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/nginx/sbin/nginx <span class="nt">-s</span> reload
</code></pre></div> </div> </li> </ol> <h3 id="44-权限设置">4.4 权限设置</h3> <p>由于你没有系统级权限，确保所有相关目录（如 <code class="language-plaintext highlighter-rouge">~/nginx</code>, <code class="language-plaintext highlighter-rouge">~/mysite</code> 等）的权限正确，并且你有访问和写入的权限。</p> <h2 id="5-部署-vue-项目">5. 部署 Vue 项目</h2> <h3 id="ubuntu-1">【Ubuntu】</h3> <p>将 Vue 项目部署到 Nginx 时，通常需要将其构建为静态文件，并配置 Nginx 提供这些文件。以下是部署步骤：</p> <h4 id="1配置-nginx">1）配置 Nginx</h4> <p>假设 Vue 项目的构建文件位于 <code class="language-plaintext highlighter-rouge">/var/www/vue_project/dist</code> 目录。</p> <p>打开 Nginx 配置文件：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nano /etc/nginx/sites-available/vue_project
</code></pre></div></div> <p>编辑配置文件，设置 Nginx 提供静态文件：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
    listen 8080<span class="p">;</span>  <span class="c"># 监听 8080 端口</span>
    server_name example.com<span class="p">;</span>  <span class="c"># 配置你的域名，或者使用 IP 或 localhost</span>

    root /var/www/vue_project/dist<span class="p">;</span>  <span class="c"># Vue 项目构建文件所在目录</span>
    index index.html<span class="p">;</span>  <span class="c"># 默认首页</span>

    location / <span class="o">{</span>
        try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ /index.html<span class="p">;</span>  <span class="c"># 支持 Vue 的 SPA 路由</span>
    <span class="o">}</span>

    <span class="c"># 如果有后端 API，需要配置反向代理</span>
    location /api <span class="o">{</span>
        proxy_pass http://localhost:3000<span class="p">;</span>  <span class="c"># 反向代理到后端 API</span>
        proxy_set_header Host <span class="nv">$host</span><span class="p">;</span>
        proxy_set_header X-Real-IP <span class="nv">$remote_addr</span><span class="p">;</span>
        proxy_set_header X-Forwarded-For <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
    <span class="o">}</span>

    <span class="c"># 禁止访问某些文件或目录</span>
    location ~ ^/<span class="o">(</span><span class="se">\.</span>user.ini|<span class="se">\.</span>htaccess|<span class="se">\.</span>git|<span class="se">\.</span><span class="nb">env</span>|<span class="se">\.</span>svn|<span class="se">\.</span>project|LICENSE|README.md<span class="o">)</span> <span class="o">{</span>
        <span class="k">return </span>404<span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <ul> <li><code class="language-plaintext highlighter-rouge">listen 8080;</code>：指定 Nginx 监听 8080 端口。</li> <li><code class="language-plaintext highlighter-rouge">root /var/www/vue_project/dist;</code>：指定 Vue 项目的构建目录。</li> <li><code class="language-plaintext highlighter-rouge">try_files $uri $uri/ /index.html;</code>：支持 Vue 项目的前端路由，将所有请求重定向到 <code class="language-plaintext highlighter-rouge">index.html</code>，让 Vue Router 处理路由。</li> </ul> <h4 id="2启用配置">2）启用配置</h4> <p>创建符号链接并启用新配置：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo ln</span> <span class="nt">-s</span> /etc/nginx/sites-available/vue_project /etc/nginx/sites-enabled/
</code></pre></div></div> <h4 id="3检查配置并重启-nginx">3）检查配置并重启 Nginx</h4> <p>确保 Nginx 配置正确：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nginx <span class="nt">-t</span>  <span class="c"># syntax is okay | test is successful</span>
</code></pre></div></div> <p>重启 Nginx：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>systemctl reload nginx
</code></pre></div></div> <h4 id="4访问应用">4）访问应用</h4> <p>现在可以在浏览器中访问 <code class="language-plaintext highlighter-rouge">http://your_server_ip:8080</code>，查看 Vue 应用。</p> <h4 id="5配置防火墙">5）配置防火墙</h4> <p>如果使用防火墙，确保允许访问 8080 端口：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw allow 8080
</code></pre></div></div> <h4 id="6配置-https使用-443-端口">6）配置 HTTPS（使用 443 端口）</h4> <p>如果需要配置 HTTPS，建议使用 Let’s Encrypt 提供免费的 SSL 证书，并通过 <code class="language-plaintext highlighter-rouge">certbot</code> 自动配置：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>certbot python3-certbot-nginx
<span class="nb">sudo </span>certbot <span class="nt">--nginx</span>
</code></pre></div></div> <h2 id="6-部署php项目">6. 部署PHP项目</h2> <h3 id="61-项目部署">6.1 项目部署</h3> <h4 id="1更新包列表">1）更新包列表</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
</code></pre></div></div> <h4 id="2安装php">2）安装PHP</h4> <p>这个命令会安装默认的PHP版本。通常它会安装PHP 7.x或8.x，具体版本取决于你的Ubuntu版本。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>php
</code></pre></div></div> <h4 id="3验证php安装">3）验证PHP安装</h4> <p>验证PHP是否安装成功</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>php <span class="nt">-v</span>
</code></pre></div></div> <blockquote> <p>如果安装成功，你会看到类似如下的信息： PHP 8.1.2 (cli) (built: Jan 20 2022 08:57:57) (NTS)</p> </blockquote> <h4 id="4安装常用的php扩展">4）安装常用的PHP扩展</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># PHP常常需要一些扩展来处理数据库连接、图像处理等功能。你可以安装常用的PHP扩展，比如</span>
<span class="c"># 这将安装PHP的命令行工具、mbstring、XML解析、MySQL支持和ZIP压缩支持。</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>php-cli php-mbstring php-xml php-mysql php-zip
</code></pre></div></div> <h4 id="5配置php-fpm">5）配置php-fpm</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># 如果你正在使用Nginx作为Web服务器，并且希望在Web服务器中启用PHP，你需要安装相应的PHP模块。</span>
<span class="c"># Nginx与PHP需要通过`php-fpm`来处理PHP请求。你可以安装`php-fpm`：</span>
<span class="nb">sudo </span>apt <span class="nb">install </span>php-fpm

<span class="c"># 先找到 PHP-FPM 的配置文件，通过下面指令</span>
<span class="nb">sudo </span>find / <span class="nt">-name</span> <span class="s2">"php-fpm.conf"</span> 2&gt;/dev/null
<span class="c"># 例如我的： /etc/php/7.4/fpm/pool.d/www.conf</span>

<span class="c"># 修改www.conf配置文件</span>
vim /etc/php/7.4/fpm/pool.d/www.conf

<span class="c"># 更改监听端口 找到;</span>
listen <span class="o">=</span> /run/php/php7.4-fpm.sock
<span class="c"># 修改为</span>
listen <span class="o">=</span> 127.0.0.1:9000
listen.allowed_clients <span class="o">=</span> 127.0.0.1

<span class="c"># 重启php-fpm</span>
systemctl restart php7.4-fpm

<span class="c"># 查询一下端口</span>
netstat <span class="nt">-lnt</span> | <span class="nb">grep </span>9000
</code></pre></div></div> <h4 id="6创建站点">6）创建站点</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server <span class="o">{</span>
    listen 7000<span class="p">;</span>
    server_name _._._._
    root /var/www/html<span class="p">;</span>      <span class="c">#网站默认目录，以后可以自己改</span>
    index index.php index.html index.htm<span class="p">;</span>
    server_name www.a.com<span class="p">;</span>      <span class="c">#网站地址</span>
    location / <span class="o">{</span>
            <span class="c"># First attempt to serve request as file, then</span>
            <span class="c"># as directory, then fall back to displaying a 404.</span>
            try_files <span class="nv">$uri</span> <span class="nv">$uri</span>/ <span class="o">=</span>404<span class="p">;</span>
    <span class="o">}</span>
    location ~ <span class="se">\.</span>php<span class="nv">$ </span><span class="o">{</span>
            include fastcgi.conf<span class="p">;</span>
            fastcgi_pass 127.0.0.1:9000<span class="p">;</span>
            fastcgi_index index.php<span class="p">;</span>
            fastcgi_split_path_info ^<span class="o">(</span>.+<span class="se">\.</span>php<span class="o">)(</span>/.+<span class="o">)</span><span class="nv">$;</span>
            fastcgi_param PATH_INFO <span class="nv">$fastcgi_path_info</span><span class="p">;</span>
            fastcgi_param PATH_TRANSLATED <span class="nv">$document_root$fastcgi_path_info</span><span class="p">;</span>
            fastcgi_param SCRIPT_FILENAME <span class="nv">$document_root$fastcgi_script_name</span><span class="p">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h4 id="7开放防火墙">7）开放防火墙</h4> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>ufw allow 7000
</code></pre></div></div> <h2 id="7-错误排查">7. 错误排查</h2> <h3 id="71-检查-nginx-错误日志">7.1 检查 Nginx 错误日志</h3> <p>查看 Nginx 错误日志，可能会给你更多的错误信息，帮助进一步排查问题。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tail</span> <span class="nt">-f</span> /var/log/nginx/error.log
</code></pre></div></div> <p>查看是否有其他相关的错误信息，特别是与 PHP-FPM 相关的错误。</p> <h3 id="72-检查-php-错误日志">7.2 检查 PHP 错误日志</h3> <p>如果问题与 PHP-FPM 配置相关，查看 PHP-FPM 的错误日志也是一个好方法。在 <code class="language-plaintext highlighter-rouge">/var/log/php7.x-fpm.log</code> 中查看是否有其他错误信息。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">tail</span> <span class="nt">-f</span> /var/log/php7.x-fpm.log
</code></pre></div></div> <div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"> <h3>文档信息</h3> <ul> <li>本文作者：<a href="https://blog.slienceme.cn" target="_blank">slience_me</a></li> <li>本文链接：<a href="https://blog.slienceme.cn/2025/02/15/Nginx%E6%93%8D%E4%BD%9C%E5%90%88%E9%9B%86/" target="_blank">https://blog.slienceme.cn/2025/02/15/Nginx%E6%93%8D%E4%BD%9C%E5%90%88%E9%9B%86/</a></li> <li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li> </ul> </div> </article> <div class="share"> <div class="share-component" data-disabled='qq,facebook'></div> </div> <div class="comment"> <script src="https://giscus.app/client.js" data-repo="slience-me/blog-comments" data-repo-id="R_kgDOKr27jA" data-category="Announcements" data-category-id="DIC_kwDOKr27jM4CnWMe" data-mapping="title" data-strict="1" data-reactions-enabled="1" data-emit-metadata="0" data-input-position="top" data-theme="light" data-lang="zh-CN" data-loading="lazy" crossorigin="anonymous" async> </script> </div> </div> <div class="column one-fourth"> <h3>Search</h3> <div id="site_search"> <div id="docsearch"> <input style="width:96%" type="text" id="search_box" placeholder="Search"> </div> </div> <script src="https://cdn.jsdelivr.net/npm/@docsearch/js@3"></script> <script type="text/javascript"> docsearch({ appId: "8W5T6R2WWG", apiKey: "e56e511c7c9f85e2c97e2817664aafb2", indexName: "doc", container: "#docsearch" }); </script> <h3 class="post-directory-title mobile-hidden">Table of Contents</h3> <div id="post-directory-module" class="mobile-hidden"> <section class="post-directory"> <dl></dl> </section> </div> <script src="https://blog.slienceme.cn/assets/js/jquery.toc.js"></script> </div> </div> </section> <footer class="container"> <div class="site-footer" role="contentinfo"> <div class="copyright left mobile-block"> <img src="/images/logo/logo.png" class="w-full" style="height: 10px;width: 10px;" alt="logo" /> <a href="https://beian.mps.gov.cn/#/query/webSearch?code=13102202000626" rel="noreferrer" target="_blank">冀公网安备13102202000626</a> | <a href="https://beian.miit.gov.cn/#/Integrated/index" target="_blank" rel="noreferrer">津ICP备2024026565号-1</a> Copyright © 2019-present slience_me&emsp; <a href="javascript:window.scrollTo(0,0)" class="right mobile-visible">TOP</a> </div> <ul class="site-footer-links right mobile-hidden"> <li> <a href="javascript:window.scrollTo(0,0)" >TOP</a> </li> </ul> <br/> <script defer src="https://vercount.one/js"></script> <div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2024-12-01 </span> </div> </div> </footer> <div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a> </div> <script src="https://blog.slienceme.cn/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://blog.slienceme.cn/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script> </body> </html>
